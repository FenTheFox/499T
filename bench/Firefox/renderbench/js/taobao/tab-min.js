/*! search-suggest 2013-08-29 */
KISSY.add("tbc/search-suggest/1.0.14/plugin/tab",function(a,b,c,d,e){function f(a){f.superclass.constructor.call(this,a||{})}return a.extend(f,b,{pluginInitializer:function(a){this._initPluginEvent.call(this,a)},tabClick:function(b){var d,e,f=this,g=f.get("caller"),h=b.currentTarget,i=c.attr(h,"data-searchtype"),j=c.attr(h,"data-defaultpage"),k=c.attr(h,"data-action"),l=g.comboBox.get("input"),m=c.parent(l,"form"),n=f.get("activeCls"),o=c.get("label",m);if(g.fire("beforeTabChange",{el:h})===!1)return!1;if(c.removeClass(c.siblings(h),n),c.addClass(h,n),g.tabNode=a.one(h),j&&m.setAttribute("data-defaultpage",j),k&&m.setAttribute("action",k),i)e=f.getDefCfg(i),k&&(e.action=k),g.update(e);else{var p=g.query||l.val(),q=c.get("a",h);if(q){var r=c.attr(q,"href");r=r.replace("/?","/search?"),r=r+"&q="+p,c.attr(q,"href",r)}}o&&(d=o.getAttribute("data-searchtype-"+i)||"",o.innerHTML=d),b.preventDefault()},_initPluginEvent:function(b){var c=this,e=c.get("activeCls"),f=c.get("node")||b.get("sugConfig").tablist;c.set("caller",b),f&&(d.on(f,"click",c.tabClick,c),a.all(f).each(function(a){a.hasClass(e)&&(b.tabNode=a)}))},update:function(b){var d,f,g,h=this,i=h.get("caller"),j=i.comboBox,k=b.sugConfig.tab,l=i.configArr[k],m=b.sugConfig,n=j.get("input"),o=c.parent(n,"form");i.configArr=i.configArr||[],f=i.get("dataSourceCfg"),g=f.xhrCfg,g.url=m.sourceUrl,a.mix(i.__attrVals,b,{deep:!0}),i.__attrVals.mods.sort=b.mods.sort,l?d=l.data:l=i.configArr[k]=""===g.url?{data:new e.LocalDataSource({data:{},parse:f.parse})}:{data:new e.RemoteDataSource(f)},j.set("dataSource",l.data),o&&c.attr(o,"action",b.action),n[0].focus(),j.sendRequest(i.query)},getDefCfg:function(b){var c;switch(b){case"shop":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?area=ssrch&k=1",resultFormat:"",tab:"shop",excludeParam:["q"]},mods:{sort:["history","list"],showExtra:!1},action:"http://shopsearch.taobao.com/search",tab:"shop"};break;case"item":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"\u7ea6{count}\u4e2a\u5b9d\u8d1d",tab:"item",excludeParam:["q"]},mods:{sort:["history","cat","global","list","shop"],showExtra:!0},action:"http://s.taobao.com/search"};break;case"mall":c={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?area=b2c&k=1",resultFormat:"\u7ea6{count}\u4e2a\u5b9d\u8d1d",tab:"mall",excludeParam:["q"]},mods:{sort:["history","cat","global","list"],showExtra:!0},action:"http://list.tmall.com/search_product.htm"};break;default:if(!a.isObject(b))return a.log("\u914d\u7f6e\u6709\u8bef"),void 0;c=b,c.sugConfig||(c.sugConfig={})}return c.sugConfig&&!c.sugConfig.tab&&(c.sugConfig.tab=c.sugConfig.sourceUrl),c}},{ATTRS:{pluginId:{value:"tab"},caller:{value:null}}}),f},{requires:["base","dom","event","combobox"]});
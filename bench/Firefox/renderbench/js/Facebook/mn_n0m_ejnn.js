/*!CK:4007328674!*//*1413168878,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Dup3k"]); }

__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads"};},null);
__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){e.exports={CONTAIN:"s",COVER:"p"};},null);
__d("SplitImage.react",["React","Image.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=g.createClass({displayName:'SplitImage',render:function(){var l=this.props.size;return (g.createElement("div",Object.assign({},this.props,{className:j(this.props.className,"_55lt"),style:Object.assign({},(this.props.style||{}),{width:l,height:l})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var l=this.props.srcs,m=Array.isArray(l);if(!m||l.length==1)return this.renderOne(m?l[0]:l);return l.length==2?this.renderTwo(l):this.renderThree(l);},renderOne:function(l){return (g.createElement(h,{src:l,width:this.props.size,height:this.props.size,alt:""}));},renderTwo:function(l){var m=this.props.size,n=Math.floor(m/2),o=-Math.floor(n/2),p=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.createElement("div",null,g.createElement("div",{className:"_55lu",style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:p,style:{width:n}},g.createElement(h,{src:l[1],width:m,height:m,style:{marginLeft:o}}))));},renderThree:function(l){var m=this.props.size,n=Math.floor(m/3*2),o=-Math.floor((m-n)/2),p=Math.floor(m/2),q=m-n,r=-Math.floor((p-q)/2),s=(("_55lu")+(this.props.border?' '+"_57pl":'')),t=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.createElement("div",null,g.createElement("div",{className:s,style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:t,style:{width:q,height:p}},g.createElement(h,{src:l[1],width:p,height:p,style:{marginLeft:r}})),g.createElement("div",{className:"_55lu",style:{width:q,height:p}},g.createElement(h,{src:l[2],width:p,height:p,style:{marginLeft:r}}))));}});e.exports=k;},null);
__d("loadImage",[],function(a,b,c,d,e,f){"use strict";function g(h,i){var j=new Image();j.onload=function(){i(j.width,j.height,j);};j.src=h;}e.exports=g;},null);
__d("PhotoResizeMath",[],function(a,b,c,d,e,f){var g={getScaledPhotoDimensions:function(h,i,j,k,l){var m=h/i,n=j/k;if(j&&k&&l==='stretch')return {width:j,height:k};if((!j&&k)||((l==='contain')!==(m>=n)))return {width:k*m,height:k};if(j)return {width:j,height:j/m};return {width:h,height:i};}};e.exports=g;},null);
__d("PixelzFocus",[],function(a,b,c,d,e,f){"use strict";var g={search:function(h,i){var j=0,k=h.length-1;while(j<=k){var l=j+Math.floor((k-j)/2),m=h[l];if(m>i){k=l-1;}else if(m<i){j=l+1;}else return l;}return Math.min(j,k);},forceSpecificPoint:function(h,i,j){var k=1e-09,l=g.search(h,i-j-k)+1,m=g.search(h,i+j);return h.slice(l,m+1);},findBiggestSets:function(h,i){var j=[],k=-1;for(var l=0;l<h.length;++l){var m=h[l],n=l,o=g.search(h,m+i),p=o-n;if(p>k)j=[];if(p>=k){k=p;j.push({low:n,high:o});}}return j;},getBestSet:function(h,i,j){var k=-1,l=null;for(var m=0;m<i.length;++m){var n=i[m],o=h[n.low],p=h[n.high],q=o+(p-o)/2,r=Math.min(o-(q-j),(q+j)-p);if(r>k){k=r;l=n;}}return l;},getFocusFromSet:function(h,i){var j=h[i.low],k=h[i.high];return j+(k-j)/2;},clampFocus:function(h,i){var j=i/2,k=1-(i/2);if(h<j)return j;if(h>k)return k;return h;},convertFromCenterToCSS:function(h,i){if(Math.abs(1-i)<1e-05)return 0;return (h-i/2)/(1-i);},convertFromCSSToCenter:function(h,i){return h*(1-i)+i/2;},getVisible:function(h,i){if(h<i)return h/i;return i/h;},getHidden:function(h,i){return 1-g.getVisible(h,i);},focusHorizontally:function(h,i){return h<i;},convertVectorFromCenterToCSS:function(h,i,j){var k=g.focusHorizontally(i,j),l;if(k){l=h.x/100;}else l=h.x/100;var m=g.convertFromCenterToCSS(l,g.getVisible(i,j));if(k){return {x:m,y:0};}else return {x:0,y:m};},getCropRect:function(h,i,j){var k=g.focusHorizontally(i,j),l=g.getVisible(i,j);if(k){var m=(1-l)*h.x;return {left:m,top:0,width:l,height:1};}else{var n=(1-l)*h.y;return {left:0,top:n,width:1,height:l};}}};e.exports=g;},null);
__d("Pixelz.react",["arrayContains","copyProperties","cx","loadImage","joinClasses","React","PhotoResizeMath","PixelzFocus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o=l.PropTypes,p=l.createClass({displayName:'Pixelz',propTypes:{width:o.number,height:o.number,resizeMode:o.oneOf(['contain','cover','stretch']),alt:o.string,letterbox:o.bool,borderRadius:o.number,insetBorderColor:o.string,animated:o.bool,upscale:o.bool,cropRect:function(q,r,s){var t=q[r],u='Invalid prop `'+r+'` supplied to `'+s+'`, expected a rectangle with values normalized '+'between 0 and 1.';if(t.left<0||t.top<0||t.width<0||t.height<0||t.left+t.width>1||t.top+t.height>1)return new Error(u);},focus:function(q,r,s){var t=q[r],u='Invalid prop `'+r+'` supplied to `'+s+'`, expected either a {x, y, type} vector where type '+'is `css` or `center` or an array of {x, y} vectors. All the vectors '+'have with values normalized between 0 and 1.';if(Array.isArray(t)){for(var v=0;v<t.length;++v)if(!(t[v].x>=0&&t[v].x<=1)||!(t[v].y>=0&&t[v].y<=1))return new Error(u);}else{if(!t.type)t.type='css';if(!(t.x>=0&&t.x<=1)||!(t.y>=0&&t.y<=1)||!g(['center','css'],t.type))return new Error(u);}}},getDefaultProps:function(){return {resizeMode:'cover',alt:'',letterbox:true,upscale:true,cropRect:{width:1,height:1,top:0,left:0},focus:{x:.5,y:.5,type:'css'}};},getInitialState:function(){return {srcDimensions:{}};},getSrcDimensions:function(){var q=this.props.src,r=this.state.srcDimensions[q];if(r)return r;j(q,function(s,t){var u={};u[q]={width:s,height:t};this.isMounted()&&this.setState({srcDimensions:u});}.bind(this));return null;},getCropSrcDimensions:function(){var q=this.getSrcDimensions();return {width:q.width*this.props.cropRect.width,height:q.height*this.props.cropRect.height};},getUpscaleCropDimensions:function(){var q=this.getCropSrcDimensions();return m.getScaledPhotoDimensions(q.width,q.height,this.props.width,this.props.height,this.props.resizeMode);},getCropDimensions:function(){var q=this.getUpscaleCropDimensions(),r=this.getCropSrcDimensions();if(!this.props.upscale)return {width:Math.min(q.width,r.width),height:Math.min(q.height,r.height)};return q;},getCropAspectRatio:function(){var q=this.getCropDimensions();return q.width/q.height;},getContainerDimensions:function(){if(this.props.letterbox&&this.props.width&&this.props.height)return {width:this.props.width,height:this.props.height};return this.getCropDimensions();},getContainerAspectRatio:function(){var q=this.getContainerDimensions();return q.width/q.height;},getContainerPosition:function(){return {left:0,top:0};},getFocus:function(){var q=this.props.focus;if(!Array.isArray(q)&&q.type==='css')return {x:q.x,y:q.y};var r=this.getContainerAspectRatio(),s=this.getCropAspectRatio(),t=n.getVisible(r,s),u=n.focusHorizontally(r,s),v;if(!Array.isArray(q)){v=n.convertFromCenterToCSS(u?q.x:q.y,t);}else{var w=q.map(function(z){return u?z.x:z.y;});w.sort();var x=n.findBiggestSets(w,t),y=n.getBestSet(w,x,t);v=n.getFocusFromSet(w,y);}return {x:u?v:.5,y:u?.5:v};},getCropPosition:function(){var q=this.getCropDimensions(),r=this.getContainerDimensions(),s=this.getFocus();return {left:s.x*(r.width-q.width),top:s.y*(r.height-q.height)};},getScaleDimensions:function(){var q=this.getCropDimensions();return {width:q.width/this.props.cropRect.width,height:q.height/this.props.cropRect.height};},getScalePosition:function(){var q=this.getScaleDimensions();return {left:-q.width*this.props.cropRect.left,top:-q.height*this.props.cropRect.top};},getClipCropRectangle:function(){var q=this.getContainerDimensions(),r=this.getCropDimensions(),s=this.getContainerPosition(),t=this.getCropPosition(),u=Math.max(s.left,t.left),v=Math.max(s.top,t.top),w=Math.min(s.top+q.height,t.top+r.height),x=Math.min(s.left+q.width,t.left+r.width);return {left:u,top:v,width:x-u,height:w-v};},getClipCropPosition:function(){var q=this.getClipCropRectangle();return {left:q.left,top:q.top};},getClipCropDimensions:function(){var q=this.getClipCropRectangle();return {width:q.width,height:q.height};},getClipScalePosition:function(){var q=this.getScalePosition(),r=this.getClipCropPosition(),s=this.getCropPosition();return {left:q.left+(s.left-r.left),top:q.top+(s.top-r.top)};},getClipScaleDimensions:function(){return this.getScaleDimensions();},areDimensionsEqual:function(q,r){return q.width===r.width&&q.height===r.height;},shouldAddAllNodesAndStyles:function(){return this.props.animated;},hasCrop:function(){if(this.shouldAddAllNodesAndStyles())return true;var q=this.getContainerDimensions(),r=this.getClipCropDimensions(),s=this.getClipScaleDimensions();if(this.areDimensionsEqual(q,r)||this.areDimensionsEqual(r,s))return false;return true;},hasContainer:function(){if(this.shouldAddAllNodesAndStyles()||this.hasInsetBorder())return true;var q=this.getContainerDimensions(),r=this.getClipScaleDimensions();if(this.areDimensionsEqual(q,r))return false;return true;},hasInsetBorder:function(){return this.shouldAddAllNodesAndStyles()||this.props.insetBorderColor;},applyPositionStyle:function(q,r){if(this.shouldAddAllNodesAndStyles()||r.left)q.left=Math.round(r.left);if(this.shouldAddAllNodesAndStyles()||r.top)q.top=Math.round(r.top);},applyDimensionsStyle:function(q,r){q.width=Math.round(r.width);q.height=Math.round(r.height);},applyBorderRadiusStyle:function(q){if(this.shouldAddAllNodesAndStyles()||this.props.borderRadius)q.borderRadius=this.props.borderRadius||0;},getScaleStyle:function(){var q={},r=this.getClipCropDimensions(),s=this.getClipScaleDimensions();if(this.shouldAddAllNodesAndStyles()||!this.areDimensionsEqual(r,s)){this.applyPositionStyle(q,this.getClipScalePosition());}else this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipScaleDimensions());this.applyBorderRadiusStyle(q);return q;},getCropStyle:function(){var q={};this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipCropDimensions());this.applyBorderRadiusStyle(q);return q;},getInsetBorderStyle:function(){var q={borderColor:this.props.insetBorderColor||'transparent'};this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipCropDimensions());this.applyBorderRadiusStyle(q);return q;},getContainerStyle:function(){var q={};this.applyDimensionsStyle(q,this.getContainerDimensions());this.applyBorderRadiusStyle(q);return q;},getScale:function(){var q=this.getScaleStyle(),r=q.width,s=q.height;q=h({},q);delete q.width;delete q.height;return (l.createElement("img",Object.assign({},this.props,{alt:this.props.alt,className:k(this.props.className,(("_56wb")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":''))),src:this.props.src,style:Object.assign({},(this.props.style||{}),q),width:r,height:s})));},getCrop:function(){var q=this.getScale();if(!this.hasCrop())return q;return (l.createElement("div",{className:(("_56ma")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getCropStyle()},q));},getInsetBorder:function(){if(!this.hasInsetBorder())return null;return (l.createElement("div",{className:(("_56lv")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getInsetBorderStyle()}));},getContainer:function(){var q=this.getCrop();if(!this.hasContainer())return q;var r=this.getInsetBorder();return (l.createElement("div",{className:(("_56jj")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getContainerStyle()},q,r));},render:function(){var q=this.getSrcDimensions();if(!q)return l.createElement("span",null);return this.getContainer();}});e.exports=p;},null);
__d("RangedCallbackManager",["CallbackManagerController","copyProperties","createObjectFrom"],function(a,b,c,d,e,f,g,h,i){var j=function(k,l,m){this._resources=[];this._reachedEndOfArray=false;this._error=false;this._existingIDs={};this._controller=new g(this._constructCallbackArg.bind(this));this._getValueHandler=k;this._compareValuesHandler=l;this._skipOnStrictHandler=m;};h(j.prototype,{executeOrEnqueue:function(k,l,m,n,o){return this._controller.executeOrEnqueue({start:k,limit:l},m,{strict:!!n,skipOnStrictHandler:o});},unsubscribe:function(k){this._controller.unsubscribe(k);},getUnavailableResources:function(k){var l=this._controller.getRequest(k),m=[];if(l&&!this._reachedEndOfArray){var n=l.request,o=this._filterForStrictResults(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;},addResources:function(k){k.forEach(function(l){if(!this._existingIDs[l]){this._existingIDs[l]=true;this._resources.push(l);this._error=null;}}.bind(this));this.resortResources();this._controller.runPossibleCallbacks();},addResourcesWithoutSorting:function(k,l){var m=this._resources.slice(0,l);m=m.concat(k);m=m.concat(this._resources.slice(l));this._resources=m;h(this._existingIDs,i(k,true));this._error=null;this._controller.runPossibleCallbacks();},removeResources:function(k){k.forEach(function(l){if(this._existingIDs[l]){this._existingIDs[l]=false;var m=this._resources.indexOf(l);if(m!=-1)this._resources.splice(m,1);}}.bind(this));},removeAllResources:function(){this._resources=[];this._existingIDs={};},resortResources:function(){this._resources=this._resources.sort(function(k,l){return this._compareValuesHandler(this._getValueHandler(k),this._getValueHandler(l));}.bind(this));},setReachedEndOfArray:function(){if(!this._reachedEndOfArray){this._reachedEndOfArray=true;this._error=null;this._controller.runPossibleCallbacks();}},hasReachedEndOfArray:function(){return this._reachedEndOfArray;},setError:function(k){if(this._error!==k){this._error=k;this._controller.runPossibleCallbacks();}},getError:function(k,l,m){var n=this._filterForStrictResults({strict:m});return k+l>n.length?this._error:null;},hasResource:function(k){return this._existingIDs[k];},getResourceAtIndex:function(k){return this._resources[k];},getAllResources:function(){return this._resources.concat();},getCurrentArraySize:function(k){return this._filterForStrictResults(k).length;},_filterForStrictResults:function(k){var l=this._resources;if(k&&k.strict){var m=k.skipOnStrictHandler||this._skipOnStrictHandler;if(m)l=l.filter(m);}return l;},_constructCallbackArg:function(k,l){var m=this._filterForStrictResults(l);if(!this._reachedEndOfArray&&!this._error&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this._error:null;return [n,o];}},getElementsUntil:function(k){var l=[];for(var m=0;m<this._resources.length;m++){var n=this._getValueHandler(this._resources[m]);if(this._compareValuesHandler(n,k)>0)break;l.push(this._resources[m]);}return l;}});e.exports=j;},null);
__d("mergeDeepInto",["invariant","mergeHelpers"],function(a,b,c,d,e,f,g,h){"use strict";var i=h.ArrayStrategies,j=h.checkArrayStrategy,k=h.checkMergeArrayArgs,l=h.checkMergeLevel,m=h.checkMergeObjectArgs,n=h.isTerminal,o=h.normalizeMergeArg,p=function(t,u,v,w){m(t,u);l(w);var x=u?Object.keys(u):[];for(var y=0;y<x.length;y++){var z=x[y];r(t,u,z,v,w);}},q=function(t,u,v,w){k(t,u);l(w);var x=Math.max(t.length,u.length);for(var y=0;y<x;y++)r(t,u,y,v,w);},r=function(t,u,v,w,x){var y=u[v],z=u.hasOwnProperty(v),aa=z&&n(y),ba=z&&Array.isArray(y),ca=z&&!ba&&!ba,da=t[v],ea=t.hasOwnProperty(v),fa=ea&&n(da),ga=ea&&Array.isArray(da),ha=ea&&!ga&&!ga;if(fa){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else if(!z)t[v]=da;}else if(ga){if(aa){t[v]=y;}else if(ba){g(i[w]);if(w===i.Clobber)da.length=0;q(da,y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;}else if(ha){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){p(da,y,w,x+1);}else !z;}else if(!ea)if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;},s=function(t,u,v){var w=o(u);j(v);p(t,w,v,0);};e.exports=s;},null);
__d("mergeDeep",["mergeHelpers","mergeDeepInto"],function(a,b,c,d,e,f,g,h){"use strict";var i=g.checkArrayStrategy,j=g.checkMergeObjectArgs,k=g.normalizeMergeArg,l=function(m,n,o){var p=k(m),q=k(n);j(p,q);i(o);var r={};h(r,p,o);h(r,q,o);return r;};e.exports=l;},null);
__d("mergeObjects",["copyProperties"],function(a,b,c,d,e,f,g){function h(){var i={};for(var j=0;j<arguments.length;j++)g(i,arguments[j]);return i;}e.exports=h;},null);
__d("DateConsts",["fbt"],function(a,b,c,d,e,f,g){var h=1000,i=60,j=60,k=24,l=7,m=365.242,n=12,o=i*j,p=o*k,q=p*m,r=h*p*l,s=h*p*m,t="Day:",u="Month:",v="Year:",w=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],x=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],z=["January","February","March","April","May","June","July","August","September","October","November","December"],aa=['',"st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"],ba={getWeekdayName:function(ca){return x[ca];},getWeekdayNameShort:function(ca){return w[ca];},getMonthName:function(ca){return z[ca-1];},getMonthNameShort:function(ca){return y[ca-1];},getOrdinalSuffix:function(ca){return aa[ca];},getDaysInMonth:function(ca,da){return (new Date(ca,da,0)).getDate();},getCurrentTimeInSeconds:function(){return Date.now()/h;},DAYS_PER_YEAR:m,HOUR_PER_DAY:k,MIN_PER_HOUR:j,MONTHS_PER_YEAR:n,MS_PER_SEC:h,MS_PER_WEEK:r,MS_PER_YEAR:s,SEC_PER_MIN:i,SEC_PER_HOUR:o,SEC_PER_DAY:p,SEC_PER_YEAR:q,DAY_LABEL:t,MONTH_LABEL:u,YEAR_LABEL:v};e.exports=ba;},null);
__d("URLMatcher",[],function(a,b,c,d,e,f){var g='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',h='\u2000-\u206F\u00ab\u00bb\uff08\uff09',i='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',j='(?:(?:ht|f)tps?)://',k='(?:(?:'+i+'[.]){3}'+i+')',l='\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+g+h+']',o='(?:(?:(?:[.:\\-_%@]|'+n+')*'+n+')|'+l+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[/?#])',s='(?:'+'(?:'+j+o+q+')|'+'(?:'+k+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>?#]+',w=new RegExp(s,'im'),x='^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]',y=new RegExp(x,'im'),z='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+')*'+')*',aa=new RegExp('('+'(?:'+s+')'+'(?:'+z+')'+')','im'),ba=new RegExp('('+'(?:'+j+o+q+')|'+'(?:'+m+o+p+q+')'+')'),ca=/[\s'";]/,da=new RegExp(t,'im'),ea=new RegExp('[\\s!"#%&\'()*,./:;<>?@[\\]^`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),fa=new RegExp('[\\s()<>?#]','im'),ga=new RegExp('\\s()<>'),ha=function(oa){if(oa&&oa.indexOf('@')!=-1){return (ba.exec(oa))?oa:null;}else return oa;},ia=function(oa){return ja(oa,aa);},ja=function(oa,pa){var qa=(pa.exec(oa)||[])[1]||null;return ha(qa);},ka=function(oa){return w.exec(oa);},la=function(oa){return !ca.test(oa.charAt(oa.length-1));},ma=function(oa){do{var pa=w.exec(oa);if(!pa)return null;var qa=false;if(pa[0][0]==='['&&pa.index>0&&oa[pa.index-1]==='@'){var ra=y.exec(pa[0]);if(ra){qa=true;oa=oa.substr(pa.index+ra[0].length);}}}while(qa);var sa=oa.substr(pa.index+pa[0].length);if(sa.length===0||!(da.test(sa[0])))return ha(pa[0]);var ta=0,ua=0,va=1,wa=0,xa=ua;for(var ya=1;ya<sa.length;ya++){var za=sa[ya];if(xa===ua){if(za==='('){wa=wa+1;xa=va;}else if(da.test(za)||!(ea.test(za))){ta=ya;}else if(fa.test(za))break;}else if(za==='('){wa=wa+1;}else if(za===')'){wa=wa-1;if(wa===0){xa=ua;ta=ya;}}else if(ga.test(za))break;}return ha(pa[0]+sa.substring(0,ta+1));},na={};na.permissiveMatch=ia;na.matchToPattern=ja;na.matchHost=ka;na.trigger=la;na.match=ma;e.exports=na;},null);
__d("formatDate",["DateConsts","DateFormatConfig","fbt","invariant"],function(a,b,c,d,e,f,g,h,i,j){function k(o,p,q){q=q||{};if(!p||!o)return '';if(typeof o==='string')o=parseInt(o,10);if(typeof o==='number')o=new Date(o*1000);j(o instanceof Date);j(!isNaN(o.getTime()));j(o.getTime()<1e+15);if(typeof p!=='string'){var r=m();for(var s in r){var t=r[s];if(t.start<=o.getTime()&&p[t.name]){p=p[t.name];break;}}}var u;if(q.skipPatternLocalization||n()||p.length===1){u=p;}else{j(h.formats[p]);u=h.formats[p];}var v=q.utc?'getUTC':'get',w=o[v+'Date'](),x=o[v+'Day'](),y=o[v+'Month'](),z=o[v+'FullYear'](),aa=o[v+'Hours'](),ba=o[v+'Minutes'](),ca=o[v+'Seconds'](),da=o[v+'Milliseconds'](),ea='';for(var fa=0;fa<u.length;fa++){var ga=u.charAt(fa);switch(ga){case '\\':fa++;ea+=u.charAt(fa);break;case 'd':ea+=l(w,2);break;case 'j':ea+=w;break;case 'S':ea+=g.getOrdinalSuffix(w);break;case 'D':ea+=g.getWeekdayNameShort(x);break;case 'l':ea+=g.getWeekdayName(x);break;case 'F':case 'f':ea+=g.getMonthName(y+1);break;case 'M':ea+=g.getMonthNameShort(y+1);break;case 'm':ea+=l(y+1,2);break;case 'n':ea+=y+1;break;case 'Y':ea+=z;break;case 'y':ea+=(''+z).slice(2);break;case 'a':if(aa<12){ea+="am";}else ea+="pm";break;case 'A':if(aa<12){ea+="AM";}else ea+="PM";break;case 'g':ea+=(aa===0||aa===12)?12:aa%12;break;case 'G':ea+=aa;break;case 'h':if(aa===0||aa===12){ea+=12;}else ea+=l(aa%12,2);break;case 'H':ea+=l(aa,2);break;case 'i':ea+=l(ba,2);break;case 's':ea+=l(ca,2);break;case 'X':ea+=l(da,3);break;default:ea+=ga;}}return ea;}function l(o,p){return Array(p-(''+o).length+1).join('0')+o;}function m(){var o=new Date(),p=o.getTime(),q=o.getFullYear(),r=o.getDate()-((o.getDay()-h.weekStart+6)%7),s=new Date(q,o.getMonth()+1,0).getDate(),t=new Date(q,1,29).getMonth()===1?366:365,u=1000*60*60*24;return [{name:'today',start:o.setHours(0,0,0,0)},{name:'withinDay',start:p-u},{name:'thisWeek',start:new Date(o.getTime()).setDate(r)},{name:'withinWeek',start:p-u*7},{name:'thisMonth',start:o.setDate(1)},{name:'withinMonth',start:p-u*s},{name:'thisYear',start:o.setMonth(0)},{name:'withinYear',start:p-u*t},{name:'older',start:-Infinity}];}k.periodNames=['today','thisWeek','thisMonth','thisYear','withinDay','withinWeek','withinMonth','withinYear','older'];function n(){if(typeof window==='undefined'||!window||!window.location)return false;var o=window.location.pathname,p='/intern';return o.substr(0,p.length)===p;}e.exports=k;},null);
__d("ReactComponentWithPureRenderMixin",["shallowEqual"],function(a,b,c,d,e,f,g){"use strict";var h={shouldComponentUpdate:function(i,j){return !g(this.props,i)||!g(this.state,j);}};e.exports=h;},null);
__d("MercuryThreadActions",["MercuryActionTypeConstants","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MessagingTag","merge","mergeInto"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){'use strict';function n(o){this.$MercuryThreadActions0=o;this.$MercuryThreadActions1=i.getForFBID(this.$MercuryThreadActions0);}n.prototype.markRead=function(o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions2(o,true));};n.prototype.markUnread=function(o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions2(o,false));};n.prototype.archive=function(o){this.$MercuryThreadActions1.changeThreadArchivedStatus(o,true);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3(o,true));};n.prototype.unarchive=function(o){this.$MercuryThreadActions1.changeThreadArchivedStatus(o,false);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3(o,false));};n.prototype.markSpam=function(o){this.$MercuryThreadActions1.markThreadSpam(o);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(o,k.SPAM));};n.prototype.unmarkSpam=function(o){this.$MercuryThreadActions1.unmarkThreadSpam(o);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(o,k.INBOX));};n.prototype.changeFolder=function(o,p){this.$MercuryThreadActions1.changeThreadFolder(o,p);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(o,p));};n.prototype["delete"]=function(o){this.$MercuryThreadActions1.deleteThread(o);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(o,g.DELETE_THREAD,h.CLIENT_DELETE_THREAD));};n.prototype.unmute=function(o){this.updateMuteSetting(o,0);};n.prototype.updateMuteSetting=function(o,p){this.$MercuryThreadActions1.changeMutingOnThread(o,p);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(o,g.CHANGE_MUTE_SETTINGS,h.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:p}));};n.prototype.$MercuryThreadActions2=function(o,p){return this.$MercuryThreadActions5(o,g.CHANGE_READ_STATUS,h.CLIENT_CHANGE_READ_STATUS,{mark_as_read:p});};n.prototype.$MercuryThreadActions3=function(o,p){return this.$MercuryThreadActions5(o,g.CHANGE_ARCHIVED_STATUS,h.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:p});};n.prototype.$MercuryThreadActions4=function(o,p){return this.$MercuryThreadActions5(o,g.CHANGE_FOLDER,h.CLIENT_CHANGE_FOLDER,{new_folder:p});};n.prototype.$MercuryThreadActions5=function(o,p,q,r){return {actions:[l({action_type:p,action_id:null,thread_id:o},r)],from_client:true,payload_source:q};};m(n,j);e.exports=n;},null);
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","CurrentUser","DOM"],function(a,b,c,d,e,f,g,h,i,j){var k={getUserIDEmail:function(){return i.getID()+'@facebook.com';},getThreadMuteSettingForUser:function(l){return l.mute_settings&&l.mute_settings[k.getUserIDEmail()];},isThreadMuted:function(l){return k.getThreadMuteSettingForUser(l)!==undefined;},showMuteChangeDialog:function(l,m){g.send(new h('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(m),function(n){n.subscribe('confirm',function(){this.hide();var o;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(r){if(r.checked)o=r.value;});switch(o){case 'always':o=-1;break;case '1hour':o=3600;break;case '8am':var p=new Date(),q=new Date();q.setHours(8);q.setMinutes(0);q.setSeconds(0);if(q>p){o=q-p;}else o=q-p+(24*3600*1000);o/=1000;break;default:o=0;}d(['MercuryThreadActions'],function(r){r.get().updateMuteSetting(l,o);});}.bind(n));});}};e.exports=k;},null);
__d("ImageSourceType",[],function(a,b,c,d,e,f){var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;},null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){"use strict";this._request.fbid=r;return this;};n.prototype.setType=function(r){"use strict";if(!l([h.PROFILE_PICTURE,h.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){"use strict";this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){"use strict";if(!l([j.COVER,j.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){"use strict";this._callback=r;return this;};n.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new i();o=r;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.getID(),mode:k.BATCH_DEFERRED_MULTI,batch_function:function(s,t){m(s.requests,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}e.exports=n;},null);
__d("MercuryCallbackRegistry",[],function(a,b,c,d,e,f){'use strict';function g(){this.$MercuryCallbackRegistry0=0;this.$MercuryCallbackRegistry1={};}g.prototype.add=function(h){var i=this.$MercuryCallbackRegistry0++;this.$MercuryCallbackRegistry1[i]=h;return {id:i,remove:this.remove.bind(this,i)};};g.prototype.call=function(h){var i=Array.prototype.slice.call(arguments,1),j=this.$MercuryCallbackRegistry1[h];if(j){delete this.$MercuryCallbackRegistry1[h];j.apply(null,i);}};g.prototype.remove=function(h){delete this.$MercuryCallbackRegistry1[h];};e.exports=g;},null);
__d("MercuryParticipants",["CurrentUser","ImageSourceRequest","ImageSourceType","MercuryAssert","MercuryCallbackRegistry","MercuryIDs","MercuryParticipantsConstants","MercuryParticipantTypes","PhotoResizeModeConst","ShortProfiles","copyProperties","getObjectValues","tx","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b('MercuryServerRequests').get(),u='fbid:'+g.getID(),v={},w={},x=new k(),y=function(da){da=ba(da);if(v[da.id]){q(v[da.id],da);}else v[da.id]=q({},da);if(da.vanity)w[da.vanity]=da.id;};function z(da){j.isEmailParticipantID(da);var ea=l.tokenize(da),fa=ea.value;return {gender:m.UNKNOWN_GENDER,href:null,id:da,image_src:m.EMAIL_IMAGE,big_image_src:m.EMAIL_IMAGE,name:fa,short_name:fa,employee:false};}function aa(da,ea){j.allParticipantIDs(da);var fa=x.add(ea),ga={},ha={};da.forEach(function(ja){if(v[ja]){ga[ja]=q({},v[ja]);}else{var ka=l.tokenize(ja);if(ka.type=='fbid'){var la=ka.value;ha[ja]=la;}else if(ka.type=='email')ga[ja]=z(ja);}});var ia=r(ha);if(ia.length){p.getMulti(ia,function(ja){for(var ka in ha){var la=ha[ka],ma=ja[la];ga[ka]={gender:ma.gender,href:ma.uri,id:ka,image_src:ma.thumbSrc,name:ma.name,short_name:ma.firstName,employee:ma.employee,is_employee_away:ma.is_employee_away,type:ma.type,vanity:ma.vanity,is_friend:ma.is_friend,orion_eligible:ma.orionEligible,social_snippets:ma.social_snippets};y(ga[ka]);}x.call(fa.id,ga);});}else x.call(fa.id,ga);return fa;}function ba(da){var ea=da.type===n.USER||da.type===n.FRIEND;if(!ea)return da;if(!da.name&&!da.href&&!da.vanity){var fa="Facebook User";da.name=fa;da.short_name=fa;}return da;}var ca={user:u,isAuthor:function(da){return da===u;},getIDFromVanityOrFBID:function(da){if(!da)return;if(w[da])return w[da];if(da.match('^\\d+$'))return l.getParticipantIDFromUserID(da);},getNow:function(da){return v[da];},get:function(da,ea){j.isParticipantID(da);return ca.getMulti([da],function(fa){ea(fa[da]);});},getMulti:function(da,ea,fa){return aa(da,ea,false);},getMap:function(da,ea){var fa=[];for(var ga in da)if(Array.isArray(da[ga])){fa=fa.concat(da[ga]);}else if(da[ga])fa.push(da[ga]);return this.getMulti(fa,function(ha){var ia={};for(var ja in da)if(Array.isArray(da[ja])){ia[ja]=da[ja].map(function(ka){return ha[ka];});}else ia[ja]=ha[da[ja]];ea(ia);});},getBigImageMulti:function(da,ea){j.allParticipantIDs(da);var fa=m.BIG_IMAGE_SIZE;return ca.getMulti(da,function(ga){var ha={},ia=0,ja=function(na,oa){ia++;ha[na]=oa;if(ia===da.length)ea(ha);},ka=function(na,oa){v[na].big_image_src=oa.uri;ja(na,oa.uri);};for(var la in ga){var ma=ga[la];if(!ma.big_image_src){new h().setFBID(l.getUserIDFromParticipantID(la)).setType(i.PROFILE_PICTURE).setDimensions(fa,fa).setResizeMode(o.COVER).setCallback(ka.bind(null,la)).send();}else ja(ma.id,ma.big_image_src);}});},getOrderedBigImageMulti:function(da,ea){return ca.getBigImageMulti(da,function(fa){var ga=da.map(function(ha){return fa[ha];});ea(ga);});},addParticipants:function(da){da.forEach(y);}};t.subscribe('update-participants',function(da,ea){ca.addParticipants(ea.participants||[]);});e.exports=ca;},null);
__d("MercuryAttachmentSnippet.react",["EmoticonsList","Image.react","MercuryAttachment","MercuryAttachmentType","MercuryConstants","MercuryIDs","MercuryParticipants","React","StickerConstants","TextWithEmoticons.react","cx","fbt","ix","joinClasses","OrionMercuryAttachmentStrings"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';var u=b('OrionMercuryAttachmentStrings').module,v=n.createClass({displayName:'MercuryAttachmentSnippet',propTypes:{thread:n.PropTypes.object.isRequired,viewer:n.PropTypes.string.isRequired},componentWillMount:function(){this._ensureParticipant(this.props.thread.snippet_sender);this._setVariables(this.props);},componentWillReceiveProps:function(z){this._ensureParticipant(z.thread.snippet_sender);this._setVariables(z);},componentWillUnmount:function(){this._cancelParticipantFetch();},render:function(){var z=this._getSenderName();if(this._hasOnlyPhotos())return this._renderPhotoSnippet(z);if(this._hasOnlyVideo())return this._renderVideoSnippet(z);if(this._hasAudioClip())return this._renderAudioClipSnippet(z);if(this._hasSticker())return this._renderStickerSnippet(z);if(this._hasOrion())return this._renderOrionSnippet(z);if(this._hasShoerackInvitation())return this._renderShoerackInvitationSnippet(z);if(this._hasShare())return this._renderShareSnippet(z);return this._renderMixedSnippet(z);},_renderPhotoSnippet:function(z){var aa;if(this._photos.length===1){if(this._isViewerSender){aa=("You sent a photo.");}else aa=(r._("{name} sent a photo.",[r.param("name",z)]));}else if(this._isViewerSender){aa=(r._("You sent {num_photos} photos.",[r.param("num_photos",this._photos.length)]));}else aa=(r._("{name} sent {num_photos} photos.",[r.param("name",z),r.param("num_photos",this._photos.length)]));return this._renderSnippet(aa);},_renderVideoSnippet:function(z){var aa;if(this._isViewerSender){aa=("You sent a video.");}else aa=(r._("{sender name} sent a video.",[r.param("sender name",z)]));return this._renderSnippet(aa);},_renderAudioClipSnippet:function(z){var aa;if(this._isViewerSender){aa=("You sent a voice message.");}else aa=(r._("{name} sent a voice message.",[r.param("name",z)]));return this._renderSnippet(aa);},_renderStickerSnippet:function(z){if(x(this._attachments[0].metadata.stickerID)){return (n.createElement(p,{renderEmoticons:true,text:g.symbols.like}));}else if(this._isViewerSender){return (n.createElement("span",null,"You sent a sticker."));}else return (n.createElement("span",null,r._("{name} sent a sticker.",[r.param("name",z)])));},_renderOrionSnippet:function(z){if(!u)return null;var aa=u.getOrionMercuryThreadAttachmentMetadataText(this._isViewerSender,z);return (n.createElement("span",null,aa));},_renderShoerackInvitationSnippet:function(z){var aa;if(this._isViewerSender){aa=("You sent a Moments invitation.");}else aa=(r._("{sender name} invited you to share photos using Moments.",[r.param("sender name",z)]));return this._renderSnippet(aa);},_renderShareSnippet:function(z){var aa;if(this._isViewerSender){aa=("You shared a link.");}else aa=(r._("{sender name} shared a link.",[r.param("sender name",z)]));return this._renderSnippet(aa);},_renderMixedSnippet:function(z){return (n.createElement("span",null,this._attachments.filter(function(aa){return aa.attach_type===j.FILE||aa.attach_type===j.PHOTO||aa.attach_type===j.VIDEO;}).map(function(aa){return this._renderSnippet(aa.name,aa.icon_type);}.bind(this))));},_renderSnippet:function(z,aa){var ba=i.getAttachIconClass(aa||this._attachments[0].icon_type),ca=t(ba,"uiIconText _3tn");return (n.createElement("span",{className:ca},n.createElement(h,{src:s('/images/messaging/docs/generic.png')}),z));},_hasOnlyPhotos:function(){return this._photos.length===this._attachments.length;},_hasOnlyVideo:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.VIDEO);},_hasAudioClip:function(){return !!(this._attachments.length===1&&this._attachments[0].metadata&&this._attachments[0].metadata.type=='fb_voice_message');},_hasSticker:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.STICKER);},_hasOrion:function(){return this._hasSingleAttachmentOfShareDataType(k.MercurySupportedShareType.FB_ORION);},_hasShoerackInvitation:function(){return this._hasSingleAttachmentOfShareDataType(k.MercurySupportedShareType.FB_SHOERACK_INVITATION);},_hasSingleAttachmentOfShareDataType:function(z){return (this._attachments.length===1&&this._attachments[0].share_data_type===z);},_hasShare:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.SHARE);},_setVariables:function(z){this._viewer=z.viewer;this._sender=z.thread.snippet_sender;this._attachments=z.thread.snippet_attachments;this._photos=w(this._attachments);this._isViewerSender=y(this._sender,this._viewer);},_getSenderName:function(){if(!this._sender||this._isViewerSender)return null;var z=m.getNow(this._sender);if(!z)return null;return z.short_name;},_ensureParticipant:function(z){if(!z)return;this._cancelParticipantFetch();if(!m.getNow(z))this._sub=m.get(z,function(aa){return this.forceUpdate();}.bind(this));},_cancelParticipantFetch:function(){this._sub&&this._sub.remove();}});function w(z){if(!z)return [];return z.filter(function(aa){return aa.attach_type===j.PHOTO;});}function x(z){return (z==o.LIKE_STICKER_ID||z==o.HOT_LIKE_SMALL_STICKER_ID||z==o.HOT_LIKE_MEDIUM_STICKER_ID||z==o.HOT_LIKE_LARGE_STICKER_ID);}function y(z,aa){return !!(z&&l.getParticipantIDFromUserID(aa)==z);}e.exports=v;},null);
__d("MercuryThreadImage.react",["MercuryIDs","MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","SplitImage.react"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m=k.createClass({displayName:'MercuryThreadImage',propTypes:{thread:k.PropTypes.object.isRequired,viewer:k.PropTypes.string.isRequired},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(n,o){this._getParticipantImages(n);},render:function(){if(this.props.thread.image_src)return (k.createElement(j,{height:i.BIG_IMAGE_SIZE,resizeMode:'cover',src:this.props.thread.image_src,width:i.BIG_IMAGE_SIZE}));if(this.state.participantImages.length>0)return (k.createElement(l,{srcs:this.state.participantImages,border:true,size:i.BIG_IMAGE_SIZE}));return null;},_getParticipantImages:function(n){var o=n.thread,p=n.viewer;if(o.image_src)return;var q=g.getParticipantIDFromUserID(p),r=o.participants.filter(function(t){return t!=q;}),s=[];if(!r.length){s=[q];}else if(r.length==1){s=r;}else s=r.slice(0,3);h.getOrderedBigImageMulti(s,function(t){this.isMounted()&&this.setState({participantImages:t});}.bind(this));}});e.exports=m;},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=function(o){return o.name;};}h.prototype.renderParticipantList=function(o){var p=o.map(this.$MercuryParticipantListRenderer1);switch(p.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(p);case 2:return k(p);case 3:return l(p);default:return m(p);}};h.prototype.setIsNewThread=function(o){this.$MercuryParticipantListRenderer0=o;return this;};h.prototype.setNameRenderer=function(o){this.$MercuryParticipantListRenderer1=o;return this;};function i(o){if(o){return ("New Message");}else return ("No Participants");}function j(o){return o[0];}function k(o){return (g._("{participant1}, {participant2}",[g.param("participant1",o[0]),g.param("participant2",o[1])]));}function l(o){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",o[0]),g.param("participant2",o[1]),g.param("participant3",o[2])]));}function m(o){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",o[0]),g.param("participant2",o[1]),g.param("participant3",o[2]),g.param("others_link",n(o.length-3))]));}function n(o){if(o>1){return (g._("{others_count} others",[g.param("others_count",o)]));}else return ("1 other");}e.exports=h;},null);
__d("MercuryThreadTitle.react",["MercuryIDs","MercuryParticipantListRenderer","MercuryParticipants","React","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){'use strict';var l=j.createClass({displayName:'MercuryThreadTitle',propTypes:{thread:j.PropTypes.object.isRequired,viewer:j.PropTypes.string.isRequired,showUnreadCount:j.PropTypes.bool},getDefaultProps:function(){return {showUnreadCount:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(m){this._renderParticipantsList(m);},render:function(){return (j.createElement("span",null,this.props.thread.name?this._renderThreadTitle():this.state.participantNames));},_renderThreadTitle:function(){var m=this.props.thread;if(!m.unread_count||!this.props.showUnreadCount)return m.name;return this._renderTitleWithUnreadCount(m.name,m.unread_count);},_renderParticipantsList:function(m){if(m.thread.name)return;var n=g.getParticipantIDFromUserID(m.viewer),o=m.thread.participants;if(o.length>1)o=o.filter(function(p){return p!=n;});i.getMulti(o,function(p){if(!this.isMounted())return;var q=o.map(function(t){return p[t];}),r=new h().renderParticipantList(q),s=(m.showUnreadCount&&m.thread.unread_count)?this._renderTitleWithUnreadCount(r,m.thread.unread_count):r;this.setState({participantNames:s});}.bind(this));},_renderTitleWithUnreadCount:function(m,n){return (k._("{conversation-title} ({unread-count})",[k.param("conversation-title",m),k.param("unread-count",n)]));}});e.exports=l;},null);
__d("WebMessengerThreadPermalinks",["MercuryIDs","MessagingTag","URI","WebMessengerPermalinkConstants","WWWBase","requireWeak"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m={getThreadURI:function(q,r,s){if(g.isCanonical(q)){n(q,r,s);}else o(q,r,s);}};function n(q,r,s){var t=new i(k.uri),u=g.tokenize(q).value;t.setPath(p(s)+'/'+u);r&&r(t.toString());}function o(q,r,s){l(['MercuryServerRequests'],function(t){var u=t.get();u.getServerThreadID(q,function(v){var w=new i(k.uri);w.setPath(j.getURIPathForThreadID(v,p(s)));r&&r(w.toString());});});}function p(q){var r=j.BASE_PATH;if(q&&q!=h.INBOX)r+='/'+q;return r;}e.exports=m;},null);
__d("MercuryErrorInfo",["MercuryActionStatus","MercuryErrorType","fbt"],function(a,b,c,d,e,f,g,h,i){var j={getMessage:function(k){var l='';if(j.isConnectionError(k)){l="This message didn't send.";if(j.isTransient(k))l=i._("{message} Check your internet connection and click to try again.",[i.param("message",l)]);}else{if(k&&k.description){l=k.description;}else l="This message failed to send.";if(j.isTransient(k))l=i._("{message} Click to send again.",[i.param("message",l)]);}return l;},isConnectionError:function(k){if(k&&k.type==h.TRANSPORT)return k.code===1001||k.code===1004||k.code===1006;return false;},isTransient:function(k){return k&&k.is_transient;},isPermanent:function(k){return k?!this.isTransient(k):false;},hasErrorStatus:function(k){return k.status===g.FAILED_UNKNOWN_REASON||k.status===g.UNABLE_TO_CONFIRM||k.status===g.ERROR;}};e.exports=j;},null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],function(a,b,c,d,e,f,g,h){'use strict';var i={generateMessageID:function(j){var k=j||Date.now(),l=h(0,4294967295),m=g.getSessionID();return ("<"+k+":"+l+"-"+m+"@mail.projektitan.com>");},generateThreadID:function(j){return 'root:'+i.generateMessageID(j);}};e.exports=i;},null);
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","MercurySendMessageFields","KeyedCallbackManager","LogHistory","MercuryActionStatus","MercuryActionTypeConstants","MercuryAssert","MercuryAttachmentType","MercuryGenericConstants","MercuryIDs","MercuryLocalIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageSourceTags","MercuryPayloadSource","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercuryMessageIDs","MercuryParticipants","RangedCallbackManager","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreadActions","MercuryThreads","copyProperties","debounceAcrossTransitions","formatDate","invariant","isNode","mergeDeep","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa){'use strict';var pa=l.getInstance('mercury_messages');function qa(ib,jb){var kb=jb;if(ib._localIdsMap[jb])kb=ib._localIdsMap[jb];return ib._messages[kb];}var ra=new k();function sa(ib,jb){if(jb.status===undefined)jb.status=m.UNSENT;jb.timestamp_absolute="Today";jb.message_id=jb.message_id||s.generateMessageID(jb.timestamp);var kb=r.getParticipantIDFromUserID(ib._fbid);jb.specific_to_list=jb.specific_to_list||[];if(jb.specific_to_list.length&&jb.specific_to_list.indexOf(kb)===-1)jb.specific_to_list.push(kb);if(!jb.thread_id){if(jb.specific_to_list.length==1){jb.thread_id='user:'+ib._fbid;}else if(jb.specific_to_list.length==2){var lb=jb.specific_to_list[0]==kb?jb.specific_to_list[1]:jb.specific_to_list[0];if(r.tokenize(lb).type=='email'){jb.thread_id=q.PENDING_THREAD_ID;}else jb.thread_id=r.getThreadIDFromParticipantID(lb);}jb.thread_id=jb.thread_id||'root:'+jb.message_id;}if(!jb.specific_to_list.length){var mb=r.tokenize(jb.thread_id),nb=mb.type,ob=mb.value;if(nb=='user')jb.specific_to_list=['fbid:'+ob,kb];}jb[j.AUTO_RETRY_CNT]=0;if(!jb[j.MANUAL_RETRY_CNT])jb[j.MANUAL_RETRY_CNT]=0;}function ta(ib,jb,kb,lb){var mb=eb(kb)?[v.CHAT]:[],nb=Date.now(),ob=ka(new Date(nb),'g:ia'),pb={action_type:jb,thread_id:lb,author:r.getParticipantIDFromUserID(ib._fbid),author_email:null,coordinates:null,timestamp:nb,timestamp_absolute:(new Date(nb)).toLocaleDateString(),timestamp_relative:ob,timestamp_time_passed:z.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:kb,source_tags:mb};return pb;}function ua(ib){switch(ib){case w.UNKNOWN:case w.SERVER_INITIAL_DATA:case w.SERVER_FETCH_THREAD_INFO:case w.SERVER_THREAD_SYNC:return true;}return false;}function va(ib){return ib&&ib.substr(0,6)==='server';}function wa(ib,jb){if(!ib._threadsToMessages[jb])ib._threadsToMessages[jb]=new ca(function(kb){return qa(ib,kb).timestamp;},function(kb,lb){return lb-kb;});return ib._threadsToMessages[jb];}function xa(ib){var jb=[];return JSON.stringify(ib,function(kb,lb){if(typeof lb==='object'&&lb!==null){if(ma(lb))return '<'+lb.nodeName+'>';if(jb.indexOf(lb)!==-1)return 'CIRCULAR';jb.push(lb);}return lb;});}da.registerCallback('mercury-messages',function(){var ib={},jb={},kb=za._getInstances();for(var lb in kb){ib[lb]={};for(var mb in kb[lb]._messages){var nb=kb[lb]._messages[mb];if(Object.keys(nb).length===0)continue;var ob=nb.thread_id;ib[lb][ob]=ib[lb][ob]||{};ib[lb][ob][nb.message_id]=JSON.parse(xa(nb));}jb[lb]=ia({},kb[lb]._localIdsMap);}var pb={};pb.local_message_ids=jb;pb.messages=ib;return pb;});function ya(ib,jb,kb){jb.forEach(function(lb){var mb=wa(ib,lb);mb.setReachedEndOfArray();ib._threadInformer.reorderedMessages(lb,kb);});}function za(ib){this._fbid=ib;this._serverRequests=ea.getForFBID(this._fbid);this._threadInformer=fa.getForFBID(this._fbid);this._threads=ha.getForFBID(this._fbid);this._threadActions=ga.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(jb,kb){var lb=(kb.actions||[]).filter(function(nb){var ob=nb.action_type;return (nb.is_forward||nb.thread_id)&&(ob==n.LOG_MESSAGE||ob==n.USER_GENERATED_MESSAGE||ob==n.SEND_MESSAGE||ob==n.CLEAR_CHAT||ob==n.DELETE_THREAD||ob==n.DELETE_MESSAGES);}),mb=ua(kb.payload_source);if(va(kb.payload_source))lb.forEach(function(nb){if(!nb.is_forward){var ob=this._threads.getThreadMetaNow(nb.thread_id);if(ob)nb.is_cleared=nb.timestamp<ob.chat_clear_time;}}.bind(this));this.handleUpdates(lb,mb,kb.payload_source,kb.from_client);if(kb.end_of_history)ya(this,kb.end_of_history,kb.payload_source);}.bind(this));pa.debug('constructed',{fbid:this._fbid});}ia(za.prototype,{getMessagesFromIDs:function(ib){return (ib||[]).map(qa.bind(null,this)).filter(function(jb){return jb;});},hasLoadedNMessages:function(ib,jb){var kb=wa(this,ib);return kb.hasReachedEndOfArray()||kb.getCurrentArraySize()>=jb;},hasLoadedExactlyNMessages:function(ib,jb){var kb=wa(this,ib);return kb.getCurrentArraySize()==jb;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(ib,jb,kb,lb,mb,nb){var ob=wa(this,ib),pb=function(xb){lb(ab(this,xb));}.bind(this),qb=ob.executeOrEnqueue(jb,kb,pb),rb=ob.getUnavailableResources(qb),sb=this._failedHistoryFetchThreads[ib];if(rb.length&&!sb){var tb=this._titanMessagesCount[ib]||0,ub=this._localTitanMessagesCount[ib]||0,vb=tb-ub,wb=rb.length+ub;pa.debug('fetch_missing_messages',{threadID:ib,offset:jb,limit:kb,missingIndices:rb,messageCount:tb,localMessageCount:ub});this._serverRequests.fetchThreadMessages(ib,vb,wb,mb,nb);}else this._failedHistoryFetchThreads[ib]=false;return qb;},getThreadMessagesSinceTimestamp:function(ib,jb){var kb=wa(this,ib),lb=kb.getElementsUntil(jb);return ab(this,lb);},hasLoadedAllMessages:function(ib){return wa(this,ib).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(ib){var jb=wa(this,ib).getAllResources();return ab(this,jb);},unsubscribe:function(ib,jb){o.isThreadID(jb);var kb=wa(this,jb);kb.unsubscribe(ib);},addAttachmentData:function(ib,jb,kb){var lb=qa(this,ib);if(lb){var mb=lb.attachments.indexOf(jb);if(mb!=-1){lb.attachments[mb]=kb;this._threadInformer.updatedMessage(lb.thread_id,lb.message_id,'attach');}}else{if(!this._attachmentData[ib])this._attachmentData[ib]=[];this._attachmentData[ib].push({attach_key:jb,data:kb});}},shouldSortOutOfOrderMessages:function(ib,jb,kb){if(ib==w.CLIENT_CHANNEL_MESSAGE){var lb=this.getThreadMessagesSinceTimestamp(jb,kb);if(lb.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},handleUpdates:function(ib,jb,kb,lb){var mb,nb={},ob={};for(var pb=0;pb<ib.length;pb++){var qb=ib[pb];if(qb.is_forward||kb==w.SERVER_SEARCH){if(!this._messages[qb.message_id]){this._messages[qb.message_id]=qb;fb(this,qb);}continue;}if(qb.client_state===u.SEND_TO_SERVER){this._messages[qb.message_id]=qb;fb(this,qb);continue;}var rb=qb.action_type;if(kb==w.CLIENT_CHANNEL_MESSAGE&&rb==n.USER_GENERATED_MESSAGE&&qb.threading_id&&this._localIdsMap[qb.threading_id]===qb.threading_id){qb.client_message_id=qb.threading_id;qb.status=m.SUCCESS;qb.action_type=n.SEND_MESSAGE;rb=qb.action_type;}if(rb==n.SEND_MESSAGE){var sb=qb.client_message_id;if(sb&&this._localIdsMap[sb]&&qb.status){var tb=qa(this,sb),ub=tb.status;if(tb.status==m.SUCCESS)continue;if(qb.status==m.UNCONFIRMED){if(!ob[qb.thread_id])ob[qb.thread_id]=[];ob[qb.thread_id].push(sb);}else if(!nb[qb.thread_id])nb[qb.thread_id]=[];this.updateLocalMessage(qb,kb);if(typeof ub!==undefined||qb.status==m.FAILED_UNKNOWN_REASON||qb.status==m.UNABLE_TO_CONFIRM||qb.status==m.SUCCESS||qb.status==m.ERROR)this._threadInformer.updatedMessage(qb.thread_id,qa(this,sb).message_id,kb);}continue;}else if(rb==n.DELETE_THREAD){wa(this,qb.thread_id).removeAllResources();continue;}else if(rb==n.DELETE_MESSAGES){var vb=qb.message_ids.map(function(cc){return qa(this,cc).message_id;}.bind(this));mb=wa(this,qb.thread_id);mb.removeResources(vb);this._threadInformer.reorderedMessages(qb.thread_id,kb);continue;}else if(rb==n.LOG_MESSAGE){if(qb.log_message_type==t.SERVER_ERROR)this._failedHistoryFetchThreads[qb.thread_id]=true;}else if(rb==n.CLEAR_CHAT){var wb=wa(this,qb.thread_id).getAllResources();wb.map(qa.bind(null,this)).forEach(function(cc){cc.is_cleared=true;});continue;}var xb=qa(this,qb.message_id);if((qb.threading_id&&this._localIdsMap[qb.threading_id])||(xb&&!xb.is_forward))continue;if(!nb[qb.thread_id])nb[qb.thread_id]=[];nb[qb.thread_id].push(qb.message_id);this._messages[qb.message_id]=qb;fb(this,qb);if(qb.threading_id&&qb.threading_id!=qb.message_id)aa.addServerID(qb.threading_id,qb.message_id);jb=jb||this.shouldSortOutOfOrderMessages(kb,qb.thread_id,qb.timestamp);if(!jb)this._threadInformer.receivedMessage(qb);}for(var yb in nb){mb=wa(this,yb);var zb=mb.getAllResources(),ac=zb.filter(function(cc){var dc=this._messages[cc];return dc.action_type==n.LOG_MESSAGE&&dc.log_message_type==t.SERVER_ERROR;}.bind(this));mb.removeResources(ac);bb(this,yb,nb[yb]);if(lb)cb(this,yb,nb[yb]);if(jb){mb.addResources(nb[yb]);this._threadInformer.reorderedMessages(yb,kb);}else mb.addResourcesWithoutSorting(nb[yb].reverse(),0);this._threadInformer.updatedThread(yb);}var bc=Object.keys(ob);if(bc.length)this._serverRequests.requestMessageConfirmation(ob);pa.debug('handle_updates',{messageCounts:na(this._titanMessagesCount),localMessageCounts:na(this._localTitanMessagesCount)});},sendMessage:function(ib,jb,kb){jb=jb||Function.prototype;sa(this,ib);this._localIdsMap[ib.message_id]=ib.message_id;if(ib.thread_id=='root:'+ib.message_id)wa(this,ib.thread_id).setReachedEndOfArray();this._serverRequests.sendNewMessage(ib,kb);if(ib.thread_id==q.PENDING_THREAD_ID){this._messages[ib.message_id]=ib;return ra.executeOrEnqueue(ib.message_id,jb);}else jb(ib.thread_id);},isOutbound:function(ib){return ib.author==ba.user;},isInbound:function(ib){return !this.isOutbound(ib);},isSending:function(ib){return (ib.status===m.UNSENT||ib.status===m.UNCONFIRMED||ib.status===m.UNABLE_TO_CONFIRM||ib.status===m.RESENDING);},isFirstMessage:function(ib){var jb=wa(this,ib.thread_id);if(jb.getCurrentArraySize()===0)return false;var kb=jb.getResourceAtIndex(jb.getCurrentArraySize()-1),lb=qa(this,kb).message_id,mb=qa(this,ib.message_id).message_id;return jb.hasReachedEndOfArray()&&lb==mb;},unsubscribeSend:function(ib){ra.unsubscribe(ib);},resendMessage:function(ib,jb){var kb=ia({},ib);kb.status=m.RESENDING;kb.timestamp=Date.now();kb.message_id=ib.message_id;kb[j.AUTO_RETRY_CNT]=0;kb[j.MANUAL_RETRY_CNT]+=1;this._messages[ib.message_id]=kb;var lb=wa(this,ib.thread_id);lb.resortResources([ib.message_id]);this.sendMessage(kb,null,jb);this._threadInformer.reorderedMessages(ib.thread_id,w.CLIENT_SEND_MESSAGE);},deleteMessages:function(ib,jb){if(jb.length){var kb=wa(this,ib),lb=kb.getCurrentArraySize()==jb.length&&kb.hasReachedEndOfArray();this._serverRequests.deleteMessages(ib,jb,lb);}},deleteLocalMessage:function(ib){if(this._localTitanMessagesCount[ib])this._localTitanMessagesCount[ib]--;},markMessagesSpam:function(ib,jb){if(jb.length){var kb=wa(this,ib),lb=kb.getCurrentArraySize()==jb.length&&kb.hasReachedEndOfArray();if(lb){this._threadActions.markSpam(ib);}else this._serverRequests.markMessagesSpam(ib,jb);}},updateLocalMessage:function(ib,jb){var kb=qa(this,ib.client_message_id);kb.status=ib.status;if(ib.status===m.SUCCESS||ib.error_data)kb.error_data=ib.error_data;var lb=ib.message_id,mb=ib.client_message_id;if(this._messages[lb])return false;this._localIdsMap[mb]=lb;this._messages[lb]=this._messages[mb];aa.addServerID(mb,lb);this._messages[mb]={};var nb=qa(this,mb);if(ib.timestamp)nb.timestamp=ib.timestamp;if(ib.attachments&&ib.attachments.length){nb.raw_attachments=null;nb.attachments=ib.attachments;fb(this,nb,lb);}if(ib.log_message_data)nb.log_message_data=ib.log_message_data;if(db(nb))this._localTitanMessagesCount[nb.thread_id]--;return true;},constructUserGeneratedMessageObject:function(ib,jb,kb,lb,mb){var nb=ta(this,n.USER_GENERATED_MESSAGE,jb,kb);if(typeof ib=='string')ib=ib.replace(/^\s+/,'').replace(/\s+$/,'');nb.body=ib;nb.has_attachment=false;nb.html_body=false;nb.attachments=[];nb.specific_to_list=lb||[];nb.creator_info=mb;return nb;},constructLogMessageObject:function(ib,jb,kb,lb){var mb=ta(this,n.LOG_MESSAGE,ib,jb);mb.log_message_type=kb;mb.log_message_data=lb;return mb;},getNumberLocalMessages:function(ib){return this._localTitanMessagesCount[ib]||0;},_uploadMessages:{},updateNewMessage:function(ib,jb,kb){if(kb.preview_attachments.length>0){ib.has_attachment=true;ib.preview_attachments=kb.preview_attachments;}ib.client_state=u.DO_NOT_SEND_TO_SERVER;ib.status=m.RESENDING;this._uploadMessages[jb]=ib;return ib;},updateMessageAfterUpload:function(ib,jb){var kb=this._uploadMessages[ib];la(kb);kb.image_ids=jb.image_ids;kb.client_state=u.SEND_TO_SERVER;return kb;},clearUploadedMessage:function(ib){delete this._uploadMessages[ib];}});ia(za,x,{addAttachmentData:function(ib,jb,kb,lb){lb=lb||i.getID();za.getForFBID(lb).addAttachmentData(ib,jb,kb);}});function ab(ib,jb){var kb=jb.map(qa.bind(null,ib));return kb.reverse();}function bb(ib,jb,kb){var lb=kb.filter(function(mb){return db(qa(ib,mb));});if(!ib._titanMessagesCount[jb])ib._titanMessagesCount[jb]=0;ib._titanMessagesCount[jb]+=lb.length;}function cb(ib,jb,kb){var lb=kb.filter(function(mb){return db(qa(ib,mb));});if(!ib._localTitanMessagesCount[jb])ib._localTitanMessagesCount[jb]=0;ib._localTitanMessagesCount[jb]+=lb.length;}function db(ib){var jb=ib.action_type;if(jb==n.USER_GENERATED_MESSAGE)return true;switch(ib.log_message_type){case t.SUBSCRIBE:case t.UNSUBSCRIBE:case t.SERVER_ERROR:case t.LIVE_LISTEN:return false;default:return true;}}function eb(ib){switch(ib){case y.CHAT_WEB:case y.CHAT_JABBER:case y.CHAT_IPHONE:case y.CHAT_MEEBO:case y.CHAT_ORCA:case y.CHAT_TEST:case y.CHAT:case y.DESKTOP:return true;default:return false;}}function fb(ib,jb,kb){kb=kb||jb.message_id;var lb=ib._attachmentData[kb];if(lb){lb.forEach(function(mb){var nb=jb.attachments.indexOf(mb.attach_key);if(nb!==-1)jb.attachments[nb]=mb.data;});delete ib._attachmentData[kb];}else if(!jb.is_forward&&gb(ib,jb)){ib._messagesNeedingAttachmentData[kb]=true;hb(ib);}}function gb(ib,jb){if(!jb||!jb.attachments)return false;for(var kb=0;kb<jb.attachments.length;kb++){var lb=jb.attachments[kb];if(typeof lb==='string'&&lb.indexOf(p.SHARE)===0)return true;}var mb=jb.forward_message_ids||[];for(kb=0;kb<mb.length;kb++){var nb=qa(ib,mb[kb]);if(gb(ib,nb))return true;}return false;}var hb=ja(function(ib){var jb={};for(var kb in ib._messagesNeedingAttachmentData){var lb=qa(ib,kb);if(gb(ib,lb))jb[kb]=true;}var mb=Object.keys(jb);if(mb.length){var nb={message_ids:mb};if(ib._fbid!=i.getID())nb.request_user_id=ib._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(nb).setAllowCrossPageTransition(true).send();}ib._messagesNeedingAttachmentData={};},0,this);e.exports=za;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryConfig","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercurySingletonMixin","MessagingReliabilityLogger","MessagingEvent","MessagingTag","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","PresenceUtil","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=w(n);for(var y in x)if(x.hasOwnProperty(y))aa[y]=x[y];var z=x===null?null:x.prototype;aa.prototype=Object.create(z);aa.prototype.constructor=aa;aa.__superConstructor__=x;function aa(ba){"use strict";this.$MercuryChannelHandler0=ba;this.$MercuryChannelHandler1=s.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=t.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=l.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler4=[];}aa.prototype.getInstanceFBID=function(){"use strict";return this.$MercuryChannelHandler0;};aa.prototype.$MercuryChannelHandler5=function(ba,ca){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandler6(ba,ca);}else this.$MercuryChannelHandler7(ba,ca);};aa.prototype.$MercuryChannelHandler7=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||!ca.obj.message){o.addEntry('channel_receive','invalid_data');return;}var da=ca.obj.message,ea={author:da.mercury_author_id,author_email:da.mercury_author_email,body:da.body,subject:da.subject,has_attachment:da.has_attachment,attachments:da.attachments,html_body:da.html_body,thread_id:da.tid,message_id:da.mid,coordinates:da.mercury_coordinates,is_spoof_warning:da.is_spoof_warning,source:da.mercury_source,source_tags:da.mercury_source_tags,threading_id:da.threading_id,timestamp:da.timestamp,timestamp_absolute:da.timestamp_absolute,timestamp_relative:da.timestamp_relative,timestamp_time_passed:da.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:da.is_unread,action_id:da.action_id,is_forward:false,forward_count:da.forward_count||da.forward,forward_message_ids:da.forward_msg_ids,location_text:da.location_text,folder:ca.obj.folder};if("sync_id" in da){ea.sync_id=da.sync_id;}else ea.action_id=da.action_id;var fa=[v({},ea)];fa=fa.concat(da.forward_actions||[]);var ga=m.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:fa,payload_source:ga},da.tid);if(!da.is_unread&&da.mercury_author_id===r.user){var ha={};ha[da.tid]=ca.obj.folder;this.$MercuryChannelHandler9(this.__getMessagingPayloadType(),{obj:{event:p.READ,tids:[da.tid],folder_info:ha,timestamp:da.timestamp}});}o.addEntry('channel_receive','success',[ea.thread_id,ea.message_id,u.getSessionID()]);};aa.prototype.$MercuryChannelHandler6=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||!ca.obj.message){o.addEntry('channel_receive','invalid_data');return;}var da=ca.obj.message,ea=da.other_user_fbid?da.other_user_fbid:da.thread_fbid,fa={author:da.mercury_author_id,author_email:da.mercury_author_email,body:da.body,subject:da.subject,has_attachment:da.has_attachment,attachments:da.attachments,html_body:da.html_body,thread_id:da.tid,thread_fbid:da.thread_fbid,other_user_fbid:da.other_user_fbid,message_id:da.mid,coordinates:da.mercury_coordinates,is_spoof_warning:da.is_spoof_warning,source:da.mercury_source,source_tags:da.mercury_source_tags,threading_id:da.threading_id,timestamp:da.timestamp,timestamp_absolute:da.timestamp_absolute,timestamp_relative:da.timestamp_relative,timestamp_time_passed:da.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:da.is_unread,is_forward:false,forward_count:da.forward_count||da.forward,forward_message_ids:da.forward_msg_ids,location_text:da.location_text,folder:ca.obj.folder};if("sync_id" in da){fa.sync_id=da.sync_id;}else fa.action_id=da.action_id;var ga=[v({},fa)];ga=ga.concat(da.forward_actions||[]);var ha=m.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:ga,payload_source:ha},ea);if(!da.is_unread&&da.mercury_author_id===r.user){var ia={};ia[ea]=ca.obj.folder;this.$MercuryChannelHandler9(this.__getMessagingPayloadType(),{obj:{event:p.READ,thread_fbids:da.thread_fbid?[da.thread_fbid]:[],other_user_fbids:da.other_user_fbid?[da.other_user_fbid]:[],folder_info:ia,timestamp:da.timestamp}});}o.addEntry('channel_receive','success',[ea,fa.message_id,u.getSessionID()]);};aa.prototype.$MercuryChannelHandler9=function(ba,ca){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlera(ba,ca);}else this.$MercuryChannelHandlerb(ba,ca);};aa.prototype.$MercuryChannelHandlerb=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||!ca.obj.tids)return;var da=[],ea=ca.obj.event==p.READ;(ca.obj.tids||[]).forEach(function(fa){da.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_id:fa,mark_as_read:ea,timestamp:ca.obj.timestamp||0,folder:ca.obj.folder_info[fa]});});this.$MercuryChannelHandler1.handleUpdate({actions:da,payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.$MercuryChannelHandlera=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||(!ca.obj.thread_fbids&&!ca.obj.other_user_fbids))return;var da=[],ea=ca.obj.event==p.READ;(ca.obj.thread_fbids||[]).forEach(function(fa){da.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:fa,mark_as_read:ea,timestamp:ca.obj.timestamp||0,folder:ca.obj.folder_info[fa]});});(ca.obj.other_user_fbids||[]).forEach(function(fa){da.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:fa,mark_as_read:ea,timestamp:ca.obj.timestamp||0,folder:ca.obj.folder_info[fa]});});this.$MercuryChannelHandler1.handleUpdate({actions:da,payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.$MercuryChannelHandlerc=function(ba,ca){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerd(ba,ca);}else this.$MercuryChannelHandlere(ba,ca);};aa.prototype.$MercuryChannelHandlere=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||!ca.obj.tids)return;var da=[];(ca.obj.tids||[]).forEach(function(ea){da.push({action_type:i.DELETE_THREAD,action_id:null,thread_id:ea});});this.$MercuryChannelHandler1.handleUpdate({actions:da,payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.$MercuryChannelHandlerd=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||!(ca.obj.thread_fbids||ca.obj.other_user_fbids))return;var da=[];(ca.obj.thread_fbids||[]).forEach(function(ea){da.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:ea});});(ca.obj.other_user_fbids||[]).forEach(function(ea){da.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:ea});});this.$MercuryChannelHandler1.handleUpdate({actions:da,payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.$MercuryChannelHandlerf=function(ba,ca){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerg(ba,ca);}else this.$MercuryChannelHandlerh(ba,ca);};aa.prototype.$MercuryChannelHandlerh=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||!ca.obj.tids||!ca.obj.mids)return;var da=ca.obj.tids[0],ea={action_type:i.DELETE_MESSAGES,action_id:null,thread_id:da,message_ids:ca.obj.mids};this.$MercuryChannelHandler1.handleUpdate({actions:[ea],threads:[ca.obj.updated_thread],payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.$MercuryChannelHandlerg=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||(!ca.obj.thread_fbids&&!ca.obj.other_user_fbids)||!ca.obj.mids)return;var da=ca.obj.thread_fbids.length?ca.obj.thread_fbids[0]:null,ea=ca.obj.other_user_fbids.length?ca.obj.other_user_fbids[0]:null,fa={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:da,other_user_fbid:ea,message_ids:ca.obj.mids};this.$MercuryChannelHandler1.handleUpdate({actions:[fa],threads:[ca.obj.updated_thread],payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.$MercuryChannelHandleri=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||!ca.obj.folder)return;var da={action_type:k.MARK_ALL_READ,action_id:ca.obj.action_id,folder:ca.obj.folder};this.$MercuryChannelHandler1.handleUpdate({global_actions:[da]});};aa.prototype.$MercuryChannelHandlerj=function(ba,ca){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerk(ba,ca);}else this.$MercuryChannelHandlerl(ba,ca);};aa.prototype.$MercuryChannelHandlerl=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj.tids)return;var da=m.CLIENT_CHANNEL_MESSAGE;(ca.obj.tids||[]).forEach(function(ea){var fa={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:ea,archived:ca.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[v({},fa)],payload_source:da},ea);},this);};aa.prototype.$MercuryChannelHandlerk=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||(!ca.obj.thread_fbids&&!ca.obj.other_user_fbids))return;var da=m.CLIENT_CHANNEL_MESSAGE;(ca.obj.thread_fbids||[]).forEach(function(ea){var fa={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:ea,other_user_fbid:null,archived:ca.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[v({},fa)],payload_source:da},ea);},this);(ca.obj.other_user_fbids||[]).forEach(function(ea){var fa={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:ea,archived:ca.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[v({},fa)],payload_source:da},ea);},this);};aa.prototype.$MercuryChannelHandlerm=function(ba,ca){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlern(ba,ca);}else this.$MercuryChannelHandlero(ba,ca);};aa.prototype.$MercuryChannelHandlero=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj.tids)return;var da=m.CLIENT_CHANNEL_MESSAGE,ea;(ca.obj.tids||[]).forEach(function(fa){if(ca.obj.event==p.TAG){ea=ca.obj.tag;}else ea=ca.obj.marked_as_spam?q.SPAM:q.INBOX;var ga={action_type:i.CHANGE_FOLDER,action_id:null,thread_id:fa,new_folder:ea};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[v({},ga)],payload_source:da},fa);},this);};aa.prototype.$MercuryChannelHandlern=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||(!ca.obj.thread_fbids&&!ca.obj.other_user_fbids))return;var da=m.CLIENT_CHANNEL_MESSAGE,ea;(ca.obj.thread_fbids||[]).forEach(function(fa){if(ca.obj.event==p.TAG){ea=ca.obj.tag;}else ea=ca.obj.marked_as_spam?q.SPAM:q.INBOX;var ga={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:fa,other_user_fbid:null,new_folder:ea};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[v({},ga)],payload_source:da},fa);},this);(ca.obj.other_user_fbids||[]).forEach(function(fa){if(ca.obj.event==p.TAG){ea=ca.obj.tag;}else ea=ca.obj.marked_as_spam?q.SPAM:q.INBOX;var ga={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:fa,thread_fbid:null,new_folder:ea};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[v({},ga)],payload_source:da},fa);},this);};aa.prototype.$MercuryChannelHandlerp=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj.tag)return;switch(ca.obj.tag){case q.ACTION_ARCHIVED:this.$MercuryChannelHandlerj(ba,ca);break;case q.INBOX:case q.OTHER:this.$MercuryChannelHandlerm(ba,ca);break;}};aa.prototype.__markAsSeen=function(ba,ca){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerq(ba,ca);}else this.$MercuryChannelHandlerr(ba,ca);};aa.prototype.$MercuryChannelHandlerr=function(ba,ca){"use strict";if(!this.$MercuryChannelHandlers(ba)||!ca.obj||!ca.obj.seen_timestamp)return;this.$MercuryChannelHandler1.handleUpdate({message_counts:[{seen_timestamp:ca.obj.seen_timestamp,folder:q.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:q.INBOX}],payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.$MercuryChannelHandlerq=function(ba,ca){"use strict";if(!this.$MercuryChannelHandlers(ba)||!ca.obj||!ca.obj.seen_timestamp)return;this.$MercuryChannelHandler1.handleUpdate({message_counts:[{seen_timestamp:ca.obj.seen_timestamp,folder:q.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:q.INBOX}],payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.__updateModelsFromMercuryPayload=function(ba,ca){"use strict";if(!this.$MercuryChannelHandlert(ba)||!ca.obj)return;this.$MercuryChannelHandler2.synchronizeInforms(function(){var da=ca.obj,ea=[];(da.actions||[]).forEach(function(fa){var ga=i.USER_GENERATED_MESSAGE;if(fa.action_type==i.LOG_MESSAGE){var ha=m.CLIENT_CHANNEL_MESSAGE,ia;if(j.MercuryFBIDGK){ia=fa.other_user_fbid||fa.thread_fbid;}else ia=fa.thread_id;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[v({},fa)],payload_source:ha},ia);}else if(fa.action_type!=ga)ea.push(fa);},this);da.actions=ea;da.payload_source=m.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdate(da);}.bind(this));};aa.prototype.$MercuryChannelHandleru=function(ba,ca){"use strict";this.$MercuryChannelHandler1.handleRoger(ca.obj);};aa.prototype.$MercuryChannelHandlerv=function(ba,ca){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerw(ba,ca);}else this.$MercuryChannelHandlerx(ba,ca);};aa.prototype.$MercuryChannelHandlerx=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||ca.obj.mute_settings===undefined||!ca.obj.thread_id)return;var da=i.CHANGE_MUTE_SETTINGS,ea=[{action_type:da,action_id:null,thread_id:ca.obj.thread_id,mute_settings:ca.obj.mute_settings}];this.$MercuryChannelHandler1.handleUpdate({actions:ea,payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.$MercuryChannelHandlerw=function(ba,ca){"use strict";if(!this.$MercuryChannelHandler8(ba)||!ca.obj||ca.obj.mute_settings===undefined||(!ca.obj.thread_fbid&&!ca.obj.other_user_fbid))return;var da=i.CHANGE_MUTE_SETTINGS,ea=[{action_type:da,action_id:null,thread_fbid:ca.obj.thread_fbid,other_user_fbid:ca.obj.other_user_fbid,mute_settings:ca.obj.mute_settings}];this.$MercuryChannelHandler1.handleUpdate({actions:ea,payload_source:m.CLIENT_CHANNEL_MESSAGE});};aa.prototype.__handleMessagingPayload=function(ba,ca){"use strict";switch(ca.obj.event){case p.DELIVER:this.$MercuryChannelHandler5(ba,ca);break;case p.READ:case p.UNREAD:this.$MercuryChannelHandler9(ba,ca);break;case p.READ_ALL:this.$MercuryChannelHandleri(ba,ca);break;case p.DELETE:this.$MercuryChannelHandlerc(ba,ca);break;case p.DELETE_MESSAGES:this.$MercuryChannelHandlerf(ba,ca);break;case p.TAG:this.$MercuryChannelHandlerp(ba,ca);break;case p.REPORT_SPAM:this.$MercuryChannelHandlerm(ba,ca);break;case p.READ_RECEIPT:this.$MercuryChannelHandleru(ba,ca);break;case p.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandlerv(ba,ca);break;}};aa.prototype.getRouting=function(){"use strict";return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};aa.prototype.__getMessagingPayloadType=function(){"use strict";return h.getArbiterType('messaging');};aa.prototype.__getMercuryPayloadType=function(){"use strict";return h.getArbiterType('mercury');};aa.prototype.__getInboxPayloadType=function(){"use strict";return h.getArbiterType('inbox');};aa.prototype.$MercuryChannelHandler8=function(ba){"use strict";return (ba==this.__getMessagingPayloadType());};aa.prototype.$MercuryChannelHandlert=function(ba){"use strict";return (ba==this.__getMercuryPayloadType());};aa.prototype.$MercuryChannelHandlers=function(ba){"use strict";return (ba==this.__getInboxPayloadType());};aa.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler4.length){var ba=this.getRouting();for(var ca in ba)this.$MercuryChannelHandler4.push(g.subscribe(h.getArbiterType(ca),ba[ca].bind(this)));}return this;};aa.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(g.unsubscribe);this.$MercuryChannelHandler4=[];}return this;};v(aa,n);e.exports=aa;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","JSLogger","MercuryActionStatus","copyProperties","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n={},o=[],p={getSeenBy:function(q,r){if(!q)return [];var s=[],t=n[q.thread_id],u=j.SUCCESS;for(var v in t)if(t[v]>q.timestamp&&(q.status===undefined||q.status===u)&&(!r||v!=q.author))s.push(v);return s;},getSeenTimestamp:function(q,r){var s=n[q];return s?s[r]:null;}};k(p,h);l.subscribe('update-roger',function(q,r){for(var s in r){if(!n[s])n[s]={};for(var t in r[s]){var u=m.getThreadMetaNow(s);if(u&&u.participants)if(u.participants.indexOf(t)==-1){o.push(n);continue;}var v=n[s][t],w=r[s][t];if(!v||w>v)n[s][t]=w;}}if(r)p.inform('state-changed',r);});g.subscribe(i.DUMP_EVENT,function(q,r){r.bad_read_receipts={receipts:o};});e.exports=p;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryRoger","copyProperties","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryMessages').get(),o=b('MercuryThreadInformer').get(),p=b('MercuryThreads').get(),q={},r={},s=j['roger.seen_delay'],t=l({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=p.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return k.getSeenBy(q[x],y);}},g);function u(x){var y=false;n.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var da=ba+s,ea=da-Date.now();if(ea>0)r[x]=m(function(){delete r[x];v(x);},ea);q[x]=aa;var fa=t.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}k.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});o.subscribe('messages-received',w);o.subscribe('messages-reordered',w);o.subscribe('messages-updated',w);e.exports=t;},null);
__d("MercuryUnseenState",["MercuryFolders","KeyedCallbackManager","LogHistory","MercuryActionTypeConstants","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","copyProperties","createObjectFrom","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=l.MAX_UNSEEN_COUNT,w='unseen_thread_hash',x='unseen_thread_list',y=i.getInstance('mercury_unseen_state');function z(na){this._fbid=na;this._serverRequests=o.getForFBID(this._fbid);this._threads=r.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new h();this._serverRequests.subscribe('update-unseen',function(oa,pa){ea(this,pa);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(oa,pa){ka(this,pa);}.bind(this));}s(z.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){y.error('unguarded_unseen_count_fetch',{});return 0;}return da(this)||0;},exceedsMaxCount:function(){return this._maxCount||(da(this)>v);},markAsSeen:function(){var na=da(this);if(na===null){this._pendingServerUpdates=true;}else if(na>0||this._maxCount){this._serverRequests.markSeen();var oa=this._serverRequests.getLastActionTimestamp();fa(this,oa,[]);}},markThreadSeen:function(na,oa){var pa={};pa[na]=0;ha(this,pa,oa);}});s(z,k);function aa(na,oa){na._unseenResources.setResource(w,oa);na._unseenResources.setResource(x,Object.keys(oa));}function ba(na,oa){var pa=na._unseenResources.executeOrEnqueue(w,oa),qa=na._unseenResources.getUnavailableResources(pa);if(qa.length)na._serverRequests.fetchUnseenThreadIDs();}function ca(na){return na._unseenResources.getResource(w);}function da(na){var oa=na._unseenResources.getResource(x);if(oa){return oa.length;}else return na._initialUnseenCount;}function ea(na,oa){var pa=ma(oa);if(oa.unseen_thread_fbids){oa.unseen_thread_fbids.forEach(function(ab){if(ab.folder!=m.INBOX)return;var bb=ab.thread_fbids||[];bb=bb.concat(ab.other_user_fbids||[]);var cb=ja(na,bb),db=na._lastSeenTimestamp;if(pa&&pa.seen_timestamp)db=pa.seen_timestamp;fa(na,db,cb);if(pa&&pa.unseen_count>v)na._maxCount=true;});}else if(pa&&pa.seen_timestamp){na._lastSeenTimestamp=pa.seen_timestamp;if(pa.unseen_count>v){na._maxCount=true;aa(na,{});}else{na._initialUnseenCount=pa.unseen_count;if(na._initialUnseenCount===0)aa(na,{});}}else{if(na._maxCount)return;var qa=oa.actions;if(!qa||!(qa.length))return;var ra={},sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];if(ua.is_forward)continue;var va=ua.action_type,wa=ua.other_user_fbid?ua.other_user_fbid:ua.thread_fbid,xa=ua.thread_id?ua.thread_id:wa;if(!la(na,ua))continue;if(va==j.USER_GENERATED_MESSAGE||va==j.LOG_MESSAGE){var ya=ra[xa]?ua.timestamp>ra[xa]:false,za=ya||!ra[xa];if(ua.is_unread&&za)na._threads.getThreadMeta(xa,function(ab){var bb=false;if(ab&&ab.last_read_timestamp)if(ab.last_read_timestamp>=ua.timestamp)bb=true;if(!q.isThreadMuted(ab)&&!bb)ra[xa]=ua.timestamp;});}else if(va==j.CHANGE_READ_STATUS&&ua.mark_as_read)sa[xa]=ua.timestamp;}ga(na,ra);ha(na,sa);}if(na._pendingServerUpdates){na._pendingServerUpdates=false;na.markAsSeen();}}function fa(na,oa,pa){var qa=ca(na);if(qa===undefined||oa>na._lastSeenTimestamp||na._maxCount){na._lastSeenTimestamp=oa;pa=pa||[];if(pa.length<=v)na._maxCount=false;var ra={},sa=ca(na)||{};for(var ta in sa)if(sa[ta]!==true){var ua=sa[ta];if(ia(na,ua))ra[ta]=ua;}var va=s(t(pa,true),ra);aa(na,va);na._threadInformer.updatedUnseenState();}}function ga(na,oa){if(na._maxCount)return;var pa={},qa=false;for(var ra in oa){var sa=oa[ra];if(ia(na,sa)){pa[ra]=sa;qa=true;}}if(!qa)return;ba(na,function(ta){for(var ua in pa){var va=pa[ua];if(!ta[ua]&&ia(na,va))ta[ua]=pa[ua];}aa(na,ta);na._threadInformer.updatedUnseenState();});}function ha(na,oa,pa){var qa=false;if(!u(oa))qa=true;if(qa)ba(na,function(ra){var sa=false;for(var ta in oa){var ua=oa[ta],va=ua>ra[ta];if(ra[ta]&&(!ua||va)){delete ra[ta];sa=true;}}if(sa){aa(na,ra);na._threadInformer.updatedUnseenState();if(pa&&da(na)===0)na._serverRequests.markSeen();}});}function ia(na,oa){return oa>na._lastSeenTimestamp;}function ja(na,oa){return oa.map(na._serverRequests.convertThreadIDIfAvailable,na._serverRequests);}function ka(na,oa){var pa=ca(na);if(!pa)return;for(var qa in oa){var ra=oa[qa];if(pa[qa]){pa[ra]=pa[qa];delete pa[qa];}}aa(na,pa);}function la(na,oa){var pa=oa.thread_id?na._threads.getThreadMetaNow(oa.thread_id):null,qa=pa?g.getFromMeta(pa):oa.folder;return qa===m.INBOX||qa===undefined;}function ma(na){var oa=(na.message_counts||[]);for(var pa=0;pa<oa.length;pa++)if(oa[pa].folder==m.INBOX)return oa[pa];return null;}n.registerCallback('mercury-unseen-state',function(){var na={};na.unseen={};na.unseen_max_count={};na.unseen_time={};var oa=z._getInstances();for(var pa in oa){na.unseen[pa]=s({},ca(oa[pa]));na.unseen_max_count[pa]=oa[pa]._maxCount;na.unseen_time[pa]=oa[pa]._lastSeenTimestamp;}return na;});e.exports=z;},null);
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MercuryStatusTemplates","Tooltip","cx","tx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q={renderParticipantListWithNoThreadName:function(r,s,t,u,v,w){var x={callback:true,check_length:true,show_unread_count:true};w=w||{};var y={};for(var z in w)if(x[z]){y[z]=w[z];delete w[z];}var aa=t.map(function(fa){return u[fa];}),ba=this.renderRawParticipantList(r,aa,t.length,w);ba=this.renderRawTitleWithUnreadCount(ba,y.show_unread_count?s.unread_count:0);var ca=w.abbr_mode,da={};for(var ea in w)da[ea]=w[ea];da.abbr_mode=true;v.forEach(function(fa){var ga=v.length>1?this._cloneIfDOMElement(ba):ba;i.setContent(fa,ga);if(y.check_length&&!ca&&fa.scrollWidth>fa.clientWidth){var ha=this.renderRawParticipantList(r,aa,t.length,da),ia=this.renderRawTitleWithUnreadCount(ha,y.show_unread_count?s.unread_count:0);i.setContent(fa,ia);}}.bind(this));y.callback&&y.callback(ba);},renderRawParticipantList:function(r,s,t,u){var v={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};u=u||{};var w=null;if(u.names_renderer){w=u.names_renderer(s);}else w=s.map(function(z){return z.name;});var x=null;if(w.length===0){if(!r){x="New Message";}else x="No Participants";}else if(w.length==1){x=w[0];}else if(w.length==2){var y={participant1:w[0],participant2:w[1]};if(u.last_separator_uses_and){x=o._("{participant1} and {participant2}",y);}else x=o._("{participant1}, {participant2}",y);}else if(u.last_separator_uses_and){if(u.abbr_mode){x=o._("{participant1} and {others_link}",{participant1:w[0],others_link:this.renderRawParticipantCount({render_subset:true,count:t-1})});}else if(w.length==3){x=o._("{participant1}, {participant2} and {participant3}",{participant1:w[0],participant2:w[1],participant3:w[2]});}else x=o._("{participant1}, {participant2} and {others_link}",{participant1:w[0],participant2:w[1],others_link:this.renderRawParticipantCount({render_subset:true,count:t-2})});}else if(w.length==3){x=o._("{participant1}, {participant2}, {participant3}",{participant1:w[0],participant2:w[1],participant3:w[2]});}else x=o._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:w[0],participant2:w[1],participant3:w[2],others_link:this.renderRawParticipantCount({render_subset:true,count:t-3})});if(Array.isArray(x))x=i.create('span',{},x);return x;},renderRawTitleWithUnreadCount:function(r,s){var t=r;if(s&&s>1)t=i.create('span',{},o._("{conversation_title} ({unread_count})",{conversation_title:r,unread_count:s}));return t;},renderRawParticipantCount:function(r){var s=r.render_subset,t;if(!s){t=r.count>1?o._("{num} people",{num:r.count}):"1 person";}else t=r.count>1?o._("{others_count} others",{others_count:r.count}):"1 other";return t;},renderShortNames:function(r){if(r.length==1)return [r[0].name];return r.map(function(s){return s.short_name;});},renderStatusIndicator:function(r,s,t){var u;if(r==j.RESENDING){u=this.renderResendIndicator();}else if(r!==undefined&&r!=j.UNSENT&&r!=j.UNCONFIRMED&&r!=j.SUCCESS)u=this.renderErrorIndicator(s,t);return u;},renderResendIndicator:function(){return l[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(r,s){if(!r)return null;var t=l[':fb:mercury:error-indicator'].render(),u=r.is_transient,v=k.getMessage(r);if(u)if(k.isConnectionError(r)){v=p._("{message} Check your internet connection and click to try again.",[p.param("message",v)]);}else v=p._("{message} Click to send again.",[p.param("message",v)]);m.set(t,v,'above','center');if(s&&u){g.listen(t,'click',s);t.setAttribute('tabindex','0');h.addClass(t,"_55q-");}return t;},_cloneIfDOMElement:function(r){if(r&&r.cloneNode){return r.cloneNode();}else return r;}};e.exports=q;},null);
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreads').get(),m={},n={updateOnSeenChange:function(p,q,r){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q,r);}};function o(p,q,r){var s=null;if(r){s=j.getIDFromVanityOrFBID(r);}else s=j.user;var t=q.participants.filter(function(v){return v!==s;}),u=q.participants.length>0&&q.participants[0]===s;g.conditionClass(p,'repliedLast',u);g.conditionClass(p,'seenByAll',u&&k.getSeenBy(q.thread_id).length===t.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;},null);
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","HTML","JSLogger","MercuryAttachmentType","MercuryIDs","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadImage.react","MercuryThreadMetadataRawRenderer","MercuryThreadTitle.react","MercuryParticipants","React","MercurySeenByAll","MercuryServerRequests","Style","MercuryThreads","Tooltip","URI","WebMessengerThreadPermalinks","arrayContains","createArrayFrom","copyProperties","cx","formatDate","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){var ha=k.create('wm_timestamp');function ia(na){this._fbid=na;this._serverRequests=v.getForFBID(na);this._threads=x.getForFBID(na);}da(ia,o);da(ia.prototype,{renderTimestamp:function(na,oa,pa,qa){if(qa){if(!oa){ha.warn('no_title');oa=(new Date(qa)).toLocaleDateString();}na.setAttribute('title',oa);na.setAttribute('data-utime',qa/1000);if(!pa){ha.warn('no_display');pa=fa(new Date(qa),'g:ia');}h.setContent(na,pa);g.show(na);}},renderMessageSourceTags:function(na,oa,pa,qa){var ra='',sa='',ta='';if(ba(pa,n.MESSENGER)){ra="Sent from Messenger";sa=new z('/mobile/messenger');ta="_9g";}else if(ba(pa,n.MOBILE)){ra="Sent from Mobile";sa=new z('/mobile/');ta="_9j";}else if(ba(pa,n.CHAT)){ra="Sent from chat";ta="_9h";}else if(ba(pa,n.EMAIL)){if(qa){ra=ga._("Sent from {email}",{email:qa});}else ra="Sent from email";ta="_9i";}if(ta){y.set(na,ra);g.addClass(oa,ta);if(sa){na.setAttribute('href',sa);}else na.removeAttribute('href');}else g.hide(na);},renderMessageLocation:function(na,oa,pa){var qa=z('/ajax/messaging/hovercard/map.php').setQueryData(pa);na.setAttribute('data-hovercard',qa);g.removeClass(na,"_b9");g.show(oa);},renderSpoofWarning:function(na,oa,pa){if(oa){g.addClass(na,"_sa");y.set(na,ga._("Unable to confirm {name_or_email} as the sender.",{name_or_email:pa.name}));}},renderChatSpoofWarning:function(na,oa,pa){if(oa)h.appendContent(na,ga._("Unable to confirm {name_or_email} as the sender.",{name_or_email:pa.name}));},renderCoreThreadlist:function(na,oa,pa,qa,ra){qa=qa||{};this.renderThreadImage(na,oa.getNode('image'));var sa=oa.getNode('accessibleName'),ta=[oa.getNode('name')];if(sa)ta.push(sa);ma(this,na,ta,qa);if(na.folder&&ra)la(oa.getNode('folderBadge'),na.folder);var ua=oa.getNode('timestamp');this.renderTimestamp(ua,na.timestamp_absolute,na.timestamp_relative,na.timestamp);this.renderSnippet(na,oa.getNode('snippet'));ka(oa,na);pa(oa,na);},renderAndSeparatedParticipantList:function(na,oa,pa){pa=pa||{};pa.last_separator_uses_and=true;this._threads.getThreadMeta(na,function(qa){ma(this,qa,oa,pa);}.bind(this));},renderSnippet:function(na,oa){var pa=false,qa=h.create('span');g.addClass(qa,'MercuryRepliedIndicator');h.appendContent(oa,qa);u.updateOnSeenChange(qa,na,this._fbid);var ra=na.snippet;if(ra){if(na.snippet_has_attachment)h.appendContent(oa,h.create('span',{className:'MercuryAttachmentIndicator'}));if(na.is_forwarded_snippet)h.appendContent(oa,h.create('strong',{className:"_55q_"},"Forwarded Message:"));if(ra.substr(0,4)=='?OTR'){ra="[encrypted message]";}else ra=ra.replace(/\r\n|[\r\n]/g," ");ra=j(i.htmlEmojiAndEmote(ra));}else{if(na.is_forwarded_snippet)h.appendContent(oa,h.create('strong',{className:"_55q_"},"Forwarded Message"));if(na.snippet_has_attachment&&na.snippet_attachments&&na.snippet_attachments.length){pa=true;ra=h.create('span');d(['MercuryAttachmentSnippet.react'],function(ua){t.renderComponent(t.createElement(ua,{thread:na,viewer:this._fbid}),ra);}.bind(this));}}var sa=na.participants.length;if(na.is_subscribed)sa--;var ta=na.snippet_sender;if(!pa&&ta&&m.getParticipantIDFromUserID(this._fbid)!=ta&&sa>1){s.get(ta,function(ua){if(ua.short_name){h.appendContent(oa,ga._("{name}: {conversation_snippet}",{name:ua.short_name,conversation_snippet:ra}));}else h.appendContent(oa,ra);});}else h.appendContent(oa,ra);},renderWebMessengerLink:function(na,oa,pa,qa){aa.getThreadURI(na,function(ra){oa.setAttribute('href',ra);pa&&pa();},qa);},renderThreadImage:function(na,oa){t.renderComponent(t.createElement(p,{thread:na,viewer:this._fbid}),oa);},renderParticipantList:function(na,oa,pa,qa){return q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(na),oa,pa,qa);},renderThreadNameAndParticipantList:function(na,oa,pa,qa){var ra=q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(na),oa,pa,qa),sa=this._threads.getThreadMetaNow(na);if(!sa.name)return ra;return ga._("{conversation_name} [with {participant_list}]",{conversation_name:sa.name,participant_list:ra});},renderParticipantCount:function(na,oa){return q.renderRawParticipantCount(oa);}});function ja(na){if(!na.snippet_attachments)return [];return na.snippet_attachments.filter(function(oa){return oa.attach_type===l.PHOTO;});}function ka(na,oa){var pa=ja(oa);if(pa.length===0)return;var qa=pa[0].thumbnail_url;if(!qa)return;var ra=(pa.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',sa=na.getNode(ra);if(!sa)return;var ta=h.find(sa,'i');w.set(ta,'background-image','url('+qa+')');g.show(sa);}function la(na,oa){ca(na).forEach(function(pa){h.setContent(pa,oa);});}function ma(na,oa,pa,qa){pa=ca(pa);var ra=na._fbid;if(oa.name){pa.forEach(function(ta){t.renderComponent(t.createElement(r,{thread:oa,viewer:ra,showUnreadCount:!!qa.show_unread_count}),ta);});return;}var sa=oa.participants;if(oa.participants.length>1)sa=oa.participants.filter(function(ta){return ta!=m.getParticipantIDFromUserID(ra);});s.getMulti(sa,function(ta){q.renderParticipantListWithNoThreadName(na._serverRequests.getServerThreadIDNow(oa.thread_id),oa,sa,ta,pa,qa);});}e.exports=ia;},null);
__d("MercuryFilters",["MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h){var i=[g.UNREAD],j={ALL:'all',getSupportedFilters:function(){return i.concat();},isSupportedFilter:function(k){return h(i,k);}};e.exports=j;},null);
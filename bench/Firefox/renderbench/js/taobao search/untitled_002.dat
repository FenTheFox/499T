KISSY.add("components/utils/wangwang",function(a,b,c,d,e,f){function g(a){try{(new Image).src=a}catch(b){}}function h(){h.superclass.constructor.apply(this,arguments),this.initStart(),this.initialize()}if(window.Light)return window.Light;var j,k=a.UA,l=window,m=document,n=encodeURIComponent,o=decodeURIComponent,p=a.now(),q=unescape((e.get("_nk_")||e.get("snk")||e.get("tracknick")||e.get("l")&&e.get("l").split("::")[0]||"").replace(/\\u/g,"%u")),r="x",s=l.navigator.userAgent,t=/Windows NT 6.2/g.test(s),u=k.ie||/MSIE ([^;]*)|Trident.*; rv(?:\s|:)?([0-9.]+)/.test(s),v=/tablet/i.test(s),w=l.g_config||{},x="J_WangWang",y=0,z=function(){var a,b=location.hostname;return b.indexOf("tmall.com")>-1?(a="tmall.com",r="otherx"):b.indexOf("daily.tmall.net")>0?(a="daily.tmall.net",r="otherx"):a=b.indexOf("taobao.net")>0?"taobao.net":"taobao.com",a}(),A=/daily/i,B=!A.test(location.host),C=function(){return B?"taobao.com":"daily.taobao.net"}(),D=function(){return e.get("_l_g_")?!0:!1},E=6,F=6===(l.g_config||0).appId,G="http://www.taobao.com/webww/?ver=1&",H="http://amos.alicdn.com/muliuserstatus.aw?beginnum=0&site=cntaobao&charset=utf-8&uids=",I="http://amos.alicdn.com/getRealCid.aw?fromId=cntaobao"+n(q)+"&fromurl="+(location.hostname+location.pathname)+"&t="+e.get("t")+"&toId=",J="http://log.mmstat.com/ww?cache="+p,K={SNS:"\u6211\u5728\u7ebf\uff0c\u548c\u6211\u804a\u804a\u5427~",DEFAULT:"\u70b9\u6b64\u53ef\u4ee5\u76f4\u63a5\u548c\u5356\u5bb6\u4ea4\u6d41\u9009\u597d\u7684\u5b9d\u8d1d\uff0c\u6216\u76f8\u4e92\u4ea4\u6d41\u7f51\u8d2d\u4f53\u9a8c\uff0c\u8fd8\u652f\u6301\u8bed\u97f3\u89c6\u9891\u5662\u3002"},L=["ie","firefox","chrome","safari","opera"],M=(location.hostname.indexOf("tmall"),[1,2,10,8,12,12,12]);a.extend(h,b,{initialize:function(){var b=this;c.addStyleSheet(".ww-light{overflow:hidden;}.ww-block{display:block;margin-top:3px;}.ww-inline{display:inline-block;vertical-align:text-bottom;}.ww-light a{text-decoration:none!important;zoom:1;}.ww-large a{width:67px;}a.ww-offline{background-position:0 -20px;}a.ww-mobile{background-position:0 -40px;}.ww-small .ww-online{background-position:-80px 0;}.ww-small .ww-offline{background-position:-80px -20px;}.ww-small .ww-mobile{background-position:-80px -40px;}.ww-static .ww-online{background-position:-110px 0;}.ww-static .ww-offline{background-position:-110px -20px;}.ww-static .ww-mobile{background-position:-110px -40px;}.ww-light a span{display:none;}"),b.light();for(var d=0,e=L.length;e>d;++d)if(a.UA[L[d]]){y=L[d]+a.UA[L[d]];break}},ready:function(){var a=this;a.initStart(),a.initialize()},addonIsOK:function(){return a.isBoolean(j)||(j=this._checkWangWangInstalled()),location.href.indexOf("topen")>-1?!1:j},data:{},lightedUsers:[],initStart:function(){var b=this;if(!F){var c=a.unparam(location.search.substring(1));("g_config"in l&&"appId"in l.g_config&&-1!=l.g_config.appId||"tstart"in c||"tdog"in c)&&a.ready(function(){var a=function(a,b){b=b||location.hostname;var c=".",d=b.split(c),e=d.length;return 2>=e?b:(a=a||1,a>e-2&&(a=e-2),d.slice(a).join(c))},c=m.getElementsByTagName("head")[0]||m.documentElement,d=(m.createElement("link"),m.createElement("script")),e=a(2),f=/daily/i,g=!f.test(location.host),h=g?"a.tbcdn.cn":"assets.daily.taobao.net",i="http://"+h+"/p/header/adapter-min.js?t="+Math.floor((new Date).getTime()/36e5);"etao.com"!=e&&(d.src=i,c.insertBefore(d,c.firstChild),!b.addonIsOK()&&l.g_config.toolbar&&l.g_config.toolbar.delay&&parseInt(l.g_config.toolbar.delay)>3&&(l.g_config.toolbar.delay=3))})}},light:function(b){function c(a){e(y[a],w[a],z[a],function(){D++,C>D&&c(++a)})}function d(a){return u&&a.length>v}function e(b,c,d,e){l.online=[],f({dataType:"jsonp",url:H+b.join(";"),data:{},jsonp:"callback",success:function(b){var f=b.data;b.success&&(a.each(c,function(b,c){0==a.query("a",b).length&&g._lightToken(b,d[c],f[c])}),e&&e())}})}b=a.get(b)||m.body;var g=this,h=a.query("."+x,b),i=h.length;if(0!==i){var j,k,o,p=[],q=[];for(o=0;i>o;++o)k=g._getParamsFromData(h[o]),p.push(k),j=k.nick,q.push(n(j));var r,s,t=100,v=1800,w=[],y=[],z=[],A="",B=0,C=0;for(r=0;i>r;++r)(d(A+q[r])||r>=t||r===i-1)&&(s=r===i-1?i:r,y[C]=q.slice(B,s),w[C]=h.slice(B,s),z[C]=p.slice(B,s),A="",B=r,C++),A+=q[r]+";";c(0);var D=0}},_lightToken:function(b,g,h){var i=this,j=c.create('<a href="javascript: void(0);" target="_blank"></a>'),k=g.encode?o(g.nick):g.nick,m=g.from+k,p=g.item,q=g.items,s=g.portal,u=m;p&&(u+="-{"+p+"}"),i.data[u]={key:u,userName:k,userId:m,fromSite:g.from,status:M[h],itemId:p,itemsId:q,portalId:s},b.className="ww-light ww-"+g.icon,j.className="ww-"+g.display,1===h?(c.addClass(j,"icon-btn-ww-online"),j.title=K.DEFAULT,w.appId&&4==w.appId&&(j.title=K.SNS),j.innerHTML="<span>\u65fa\u65fa\u5728\u7ebf</span>"):(c.addClass(j,"icon-btn-ww-offline"),j.innerHTML="<span>\u65fa\u65fa\u79bb\u7ebf</span>"),j.href=G+i._paramUserInfo(i.data[u],!0),d.on(j,"click",function(b){{var c=a.unparam(e.get(r)),d=i.data[u];unescape((e.get("_nk_")||e.get("snk")||e.get("tracknick")||e.get("l")&&e.get("l").split("::")[0]||"").replace(/\\u/g,"%u"))}if((i.addonIsOK()||c&&1==c.e)&&b.preventDefault(),!i.addonIsOK()&&(b.preventDefault(),i._isOtherHost()))return void(t?l.location="aliim:sendmsg?"+i._paramUserInfo(d,null,j):(alert("\u4f60\u6ca1\u6709\u5b89\u88c5\u963f\u91cc\u65fa\u65fa,\u8bf7\u4e0b\u8f7d\u963f\u91cc\u65fa\u65fa!"),window.open("http://www.taobao.com/wangwang")));if(!d.dispatched&&4>h&&-1==d.userId.indexOf(":")){if(0===location.href.indexOf("http://trade.taobao.com/")||-1!==location.href.indexOf("http://list.taobao.com/")||0===location.href.indexOf("http://list.tmall.com/search_product.htm")||0===location.href.indexOf("http://s.taobao.com/"))var g="";else var g="&clientX="+b.clientX+"&clientY="+b.clientY;f.getScript(I+n(d.userId)+"&charset=utf-8"+g,function(){var a=o(l.realcid);a&&a!==d.userId&&(d.userName=a.substring(8),d.userId=a),d.dispatched=!0,i._openChatDialog(d,j)},"utf-8")}else i._openChatDialog(d,j)}),b.appendChild(j)},_setCookie:function(){e.set(r,a.param(cookieX),365,z,"/")},_directToTBLogin:function(b){var c=location,d=c.protocol+"//"+c.host+c.pathname,e=c.search,f=c.hash,g=c.href,h="wwlight",i="https://login."+C+"/member/login.jhtml?f=top";e=e?a.unparam(e.substring(1)):{},h in e&&delete e[h],b&&(e[h]=b),e=a.param(e),g=d+"?"+e+f,g=n(g),c.href=i+"&redirectURL="+g},_openTBLoginPopup:function(b){function e(b){c.css(b,"left",parseInt(c.viewportWidth()/2)-parseInt(p.offsetWidth/2)+"px"),c.css(b,"top",parseInt(c.viewportHeight()/2)-parseInt(p.offsetHeight/2)+(6===a.UA.ie?c.scrollTop():0)+"px")}var f,g=location,h=g.protocol+"//"+g.host+g.pathname,i=g.search,j=g.hash,k=g.href,l="wwlight",m=this,n=location.hostname.indexOf("taobao.com")>-1;i=i?a.unparam(i.substring(1)):{},l in i&&delete i[l],b&&(i[l]=b,m.isSearch()?(f=i.q,delete i.q,i[l]=b):i[l]=b),i=a.param(i),this.isSearch()&&f&&(i="q="+f+"&"+i),k=h+"?"+i+j;var g=location;c.addStyleSheet(".tstart-login{width:410px;height:300px;bottom:100px;left:200px;opacity:1;position:fixed;_position:absolute;z-index:100000000;background-color:#fff;padding:0;overflow:hidden;-moz-border-radius-bottomleft:5px;-moz-border-radius-bottomright:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px;border:7px solid #BBB;}.tstart-login .hd{height:22px;line-height:22px;padding-left:8px;border-bottom:1px solid #D1D1D1;font-weight:bold;background-color:#fff;}.tstart-login .ft{background-color:#F5F5F5;}.tstart-login .ft .btn-close{color:#C9C9C9;font-family:Tahoma,sans;font-size:12px;font-weight:bold;position:absolute;right:8px;text-decoration:none;top:3px;}");var o='<div id="tstartLogin" class="tstart-login"><div class="hd"><h3></h3></div><div class="bd" style="padding: 0px; overflow: hidden;"><iframe width="410" height="270" frameborder="0" scrolling="no" id="frameContent" name="frameContent" ></iframe></div><div class="ft"><a class="btn-close" title="\u5173\u95ed\u6b64\u7a97\u53e3" href="javascript:void(0)">x</a></div></div>',p=a.get(".tstart-login");if(p)c.css(p,"display","block"),e(p);else{if(p=a.DOM.create(o),document.body.appendChild(p),e(p),d.on(a.get(".btn-close",p),"click",function(){c.css(p,"display","none")}),6===a.UA.ie?d.on(window,"scroll resize",function(){e(p)}):d.on(window,"scroll resize",function(){c.css(p,"left",parseInt(c.viewportWidth()/2)-parseInt(p.offsetWidth/2)+"px")}),n)var q="http://www.taobao.com/go/act/share/loginsuccess.php";else var q="http://www.daily.taobao.net/go/act/share/loginsuccess.php";var r="https://login."+C+"/member/login.jhtml?style=mini&full_redirect=false&redirect_url="+q,s=p.getElementsByTagName("iframe")[0];s.src=r,d.on(s,"load",function(){D()&&(location.href=k)})}},_isOtherHost:function(){var a=location.hostname,b=["tmall.net","tmall.com","taobao.com","daily.taobao.net"],c=b.length;for(i=0;c>i;i++)if(a.indexOf(b[i])>-1)return!1;return!0},isSearch:function(){var a,b=["search.taobao.com","sandbox.search.taobao.com","search8.taobao.com","search8.daily.taobao.net","s.taobao.com","list.mall.daily.taobao.net","list.mall.taobao.com","s8.taobao.com"],c=b.length,d=location;for(a=0;c>a;a++)if(d.host.indexOf(b[a])>-1)return!0},_paramUserInfo:function(a,b,c){var d=a.userId||a.siteid+a.touid,e="";return b&&(d=n(d)),6!=E?"uid="+d.split("cntaobao")[1]+"&tositeid="+a.fromSite+"&status="+a.status+"&suid="+a.portalId:(c&&c.parentNode&&(e=c.parentNode.getAttribute("data-items")||""),"&touid="+d+"&siteid="+(a.fromSite||a.siteid)+"&status="+a.status+"&portalId="+(a.portalId||"")+"&gid="+(a.itemId||"")+"&itemsId="+e)},_openChatDialog:function(b,c){var d=this,f=1;if(d.userInfo=b,d.link=c,d.addonIsOK()){if(u)try{new ActiveXObject("AliIMX.WangWangX").ExecCmd("Aliim:sendmsg?"+d._paramUserInfo(b,!0,c))}catch(h){l.location="aliim:sendmsg?"+d._paramUserInfo(b,null,c)}else d._openChatDialogInUnIE(b,c);f=0}else{if(!t)return void d._openWebWW();if(v)d._openDialogBySelectionDialog(b,c,2);else{var i=a.unparam(e.get(r)).c;i>1?d._openDialogBySelectionDialog(b,c,i):d._createSelectionDialog()}}g(J+"&uid="+q+"&tid="+b.userId+"&gid="+b.itemId+"&ver="+f+"&browse="+y+"&playform="+navigator.platform)},_openWebWW:function(){var b=this,c=b.userInfo,d=a.unparam(e.get(r)),f=unescape((e.get("_nk_")||e.get("snk")||e.get("tracknick")||e.get("l")&&e.get("l").split("::")[0]||"").replace(/\\u/g,"%u"));return""==f?void(z.indexOf("tmall")>-1?b._directToTBLogin(c.key):b._openTBLoginPopup(c.key)):void(d&&1==d.e&&window.TDog&&TDog.EventCenter&&(b._isOtherHost()||TDog.EventCenter.fire(TDog.EVENTS.CLICK_LIGHT_ICON,{userInfo:c}),g(J+"&uid="+f+"&tid="+c.userId+"&gid="+c.itemId+"&ver=2&browse="+y+"&playform="+navigator.platform)))},_openChatDialogInUnIE:function(a,b){var c=this;if(c.plugin){var d=c.numberify(c.plugin.NPWWVersion());if(k.webkit&&1.005>d)l.location="aliim:sendmsg?"+c._paramUserInfo(a,null,b);else try{var e="aliim:sendmsg?"+c._paramUserInfo(a,!0,b);c.plugin.SendCommand(e,1)}catch(f){l.location="aliim:sendmsg?"+c._paramUserInfo(a,null,b)}}else l.location="aliim:sendmsg?"+c._paramUserInfo(a,null,b)},_createSelectionDialog:function(){var b=this,f=a.unparam(e.get(r));if(b.selectionDialog)h=b.selectionDialog,h.style.display="block";else{c.addStyleSheet("#J_Windows8_Selection_Dialog{display:block;width:440px;height:270px;position:fixed;top: 50%;left:50%;margin:-134px 0 0 -220px;padding:0;z-index:100000001;}#J_Windows8_Selection_Dialog_Bg{width:100%;height:100%;background:#000;opacity:0.2;filter:alpha(opacity=20);position:fixed;left:0;top:0;z-index:100000000;}#J_Windows8_Selection_Dialog .win8-dialog-bg{display:block;width: 440px;height:270px;background:#000;opacity:0.2;filter:alpha(opacity=20);position:absolute;top:0;left:0;padding:0;margin:0;}#J_Windows8_Selection_Dialog .win8-dialog-con{display:block;margin:5px;width:390px;height:220px;background:#fff;position:absolute;top:0;left:0;font:14px/1.5 Microsoft YaHei;padding:20px;}#J_Windows8_Selection_Dialog h4{font-size:18px;font-weight:bold;padding:0;margin:0;color:#000;}#J_Windows8_Selection_Dialog ul{padding:15px 0 30px 20px;margin:10px 0 0 0;}#J_Windows8_Selection_Dialog li{padding:0 0 0 40px;margin:0;list-style:none;background:url('http://img02.taobaocdn.com/tps/i2/T1pEcjXdRhXXcCnGHx-30-300.png') no-repeat 0 2px;height:30px;line-height:30px;font-size: 16px;color: #000;cursor:pointer;}#J_Windows8_Selection_Dialog li.win8-slt{background-position: 0 -45px;}#J_Windows8_Selection_Dialog li.win8-tip{background:none;cursor:default;font-size:12px;color:#666;line-height:16px;height:16px;margin-bottom:5px;}#J_Windows8_Selection_Dialog .win8-btn{font-size:14px;padding:30px 0 0 0;border-top:1px solid #ddd;}#J_Windows8_Selection_Dialog .win8-cb{display:block;float:left;margin:5px 50px 0 0;padding:0;}#J_Windows8_Selection_Dialog .win8-cb input{vertical-align:-1px;margin-right:5px;}#J_Windows8_Selection_Dialog .win8-btn a{display: block;float:left;width:96px;height:28px;background:#fff;border:2px solid #ddd;color:#737373;text-decoration:none;text-align:center;line-height:28px;font-size:16px;margin-right:15px;overflow:hidden;}#J_Windows8_Selection_Dialog .win8-btn a:hover{background:#00ade8;color:#fff;text-decoration:none;}#J_Windows8_Btn_Close{display:block;width:40px;height:40px;background:url('http://img02.taobaocdn.com/tps/i2/T1pEcjXdRhXXcCnGHx-30-300.png') no-repeat 8px -113px;position:absolute;top:0;right:0;text-indent:-9999px;}#J_Windows8_Btn_Close:hover{background-position:8px -188px}");var g='<div><div id="J_Windows8_Selection_Dialog_Bg" class="win8-bg"></div><div id="J_Windows8_Selection_Dialog"><div class="win8-dialog-bg"></div><div class="win8-dialog-con"><h4>\u8bf7\u9009\u62e9\u9700\u8981\u6253\u5f00\u7684\u65fa\u65fa\uff1a</h4><ul><li class="win8-slt J_Windows8_selection_item" data-value="2">\u963f\u91cc\u65fa\u65fa for Windows 8</li><li class="win8-tip">\u5982\u679c\u672a\u5b89\u88c5\uff0c\u8bf7\u5148\u5728\u5e94\u7528\u5546\u5e97\u4e0b\u8f7d\u5b89\u88c5</li><li class="J_Windows8_selection_item" data-value="3">\u963f\u91cc\u65fa\u65fa\u7f51\u9875\u7248</li></ul><div class="win8-btn"><label class="win8-cb"><input type="checkbox" id="J_Window8_remember" />\u8bb0\u4f4f\u6211\u7684\u9009\u62e9</label><a href="javascript:;" title="\u786e\u5b9a" id="J_Windows8_Btn_Yes">\u786e\u5b9a</a><a href="javascript:;" title="\u53d6\u6d88" id="J_Windows8_Btn_No">\u53d6\u6d88</a></div><a href="javascript:;" title="\u5173\u95ed" id="J_Windows8_Btn_Close">\u5173\u95ed</a></div></div></div>',h=c.create(g);b.selectionDialog=h,m.body.appendChild(h),d.on(h,"click",function(d){var g=d.target;if("J_Windows8_Btn_Yes"===g.id){var i=c.attr(c.get(".win8-slt"),"data-value");c.get("#J_Window8_remember").checked?(f.c=parseInt(i),e.set(r,a.param(f),365,z,"/"),b._destorySelectionDialog()):h.style.display="none",b._openDialogBySelectionDialog(b.userInfo,b.link,i)}else"J_Windows8_Btn_No"===g.id||"J_Windows8_Btn_Close"===g.id?h.style.display="none":c.hasClass(g,"J_Windows8_selection_item")&&!c.hasClass("win8-slt")&&(c.addClass(g,"win8-slt"),c.removeClass(c.siblings(g),"win8-slt"))})}},_destorySelectionDialog:function(){var a=this;c.remove(a.selectionDialog),d.remove(a.selectionDialog,"click"),a.selectionDialog=null},_openDialogBySelectionDialog:function(a,b,c){var d=this;2==c?l.location.href="aliim:sendmsg?"+d._paramUserInfo(a,null,b):3==c&&d._openWebWW(a)},_checkWangWangInstalled:function(){var b=this,c=!1,d=(a.unparam(e.get(r)),navigator.platform.indexOf("Mac")>-1?!0:!1);if(d){if(k.firefox||k.chrome||k.opera||k.safari){var f=navigator.mimeTypes["application/ww-plugin"];if(f){var g=m.createElement("embed");g.setAttribute("type","application/ww-plugin"),a.DOM.css(g,"visibility","hidden"),a.DOM.css(g,"width",0),a.DOM.css(g,"height",0),KISSY.ready(function(){m.body.appendChild(g);try{g.isMacWWInstalled()&&(c=!0)}catch(a){}g.parentNode.removeChild(g)})}}}else if(!c&&u)c=b._checkWangWangVersion();else{var f=navigator.mimeTypes["application/ww-plugin"];if(f){var g=m.createElement("embed");g.setAttribute("type","application/ww-plugin"),a.DOM.css(g,"visibility","hidden"),a.DOM.css(g,"width",0),a.DOM.css(g,"height",0),m.body.appendChild(g);var h=b.numberify(g.NPWWVersion());c=g.NPWWVersion&&h>=1.003?!0:!1,b.plugin=g}}return location.href.indexOf("topen")>-1&&(c=!1),c},numberify:function(a){var b=0;return parseFloat(a.replace(/\./g,function(){return 0===b++?".":""}))},_checkWangWangVersion:function(){{var b,c=!0;a.unparam(e.get(r))}try{b=new ActiveXObject("aliimx.wangwangx")}catch(d){try{b=new ActiveXObject("WangWangX.WangWangObj"),E=5}catch(d){c=!1}}finally{b=null}return c},_getParamsFromData:function(a){var b=c.attr(a,"data-encode")||!1,d=c.attr(a,"data-nick")||"";return b&&(d=o(d)),{nick:d,item:c.attr(a,"data-item")||(l.g_config||{}).itemId||"",items:c.attr(a,"data-items")||"",display:c.attr(a,"data-display")||"inline",icon:c.attr(a,"data-icon")||"large",from:c.attr(a,"data-from")||"cntaobao",portal:c.attr(a,"data-portal")||"",fromId:c.attr(a,"data-portal")||"",encode:n}}});var N=new h;return window.Light=N,N},{requires:["base","dom","event","cookie","ajax"]});